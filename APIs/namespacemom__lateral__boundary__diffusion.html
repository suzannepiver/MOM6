<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MOM6: mom_lateral_boundary_diffusion Module Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MOM6
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('namespacemom__lateral__boundary__diffusion.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Types</a> &#124;
<a href="#func-members">Functions/Subroutines</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">mom_lateral_boundary_diffusion Module Reference</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Calculates and applies diffusive fluxes as a parameterization of lateral mixing (non-neutral) by mesoscale eddies near the top and bottom (to be implemented) boundary layers of the ocean. </p>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Types</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">type &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmom__lateral__boundary__diffusion_1_1lateral__boundary__diffusion__cs.html">lateral_boundary_diffusion_cs</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets parameters for lateral boundary mixing module.  <a href="structmom__lateral__boundary__diffusion_1_1lateral__boundary__diffusion__cs.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:a4eb098abd02dbf022558e4bedfe9cdef"><td class="memItemLeft" align="right" valign="top">logical function, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__lateral__boundary__diffusion.html#a4eb098abd02dbf022558e4bedfe9cdef">lateral_boundary_diffusion_init</a> (Time, G, param_file, diag, diabatic_CSp, CS)</td></tr>
<tr class="memdesc:a4eb098abd02dbf022558e4bedfe9cdef"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialization routine that reads runtime parameters and sets up pointers to other control structures that might be needed for lateral boundary diffusion.  <a href="namespacemom__lateral__boundary__diffusion.html#a4eb098abd02dbf022558e4bedfe9cdef">More...</a><br /></td></tr>
<tr class="separator:a4eb098abd02dbf022558e4bedfe9cdef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afac71bffe2368a84b543f4d7f60703e0"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__lateral__boundary__diffusion.html#afac71bffe2368a84b543f4d7f60703e0">lateral_boundary_diffusion</a> (G, GV, US, h, Coef_x, Coef_y, dt, Reg, CS)</td></tr>
<tr class="memdesc:afac71bffe2368a84b543f4d7f60703e0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Driver routine for calculating lateral diffusive fluxes near the top and bottom boundaries. Two different methods are available: Method 1: lower order representation, calculate fluxes from bulk layer integrated quantities. Method 2: more straight forward, diffusion is applied layer by layer using only information from neighboring cells.  <a href="namespacemom__lateral__boundary__diffusion.html#afac71bffe2368a84b543f4d7f60703e0">More...</a><br /></td></tr>
<tr class="separator:afac71bffe2368a84b543f4d7f60703e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a764405ce85234799f6b81be25a8df1b7"><td class="memItemLeft" align="right" valign="top">real function&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__lateral__boundary__diffusion.html#a764405ce85234799f6b81be25a8df1b7">bulk_average</a> (boundary, nk, deg, h, hBLT, phi, ppoly0_E, ppoly0_coefs, method, k_top, zeta_top, k_bot, zeta_bot)</td></tr>
<tr class="separator:a764405ce85234799f6b81be25a8df1b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c98f54ad462ab45918fdccc0b403948"><td class="memItemLeft" align="right" valign="top">real function&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__lateral__boundary__diffusion.html#a6c98f54ad462ab45918fdccc0b403948">harmonic_mean</a> (h1, h2)</td></tr>
<tr class="memdesc:a6c98f54ad462ab45918fdccc0b403948"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate the harmonic mean of two quantities See <a class="el" href="namespacemom__lbd.html#section_harmonic_mean">Harmonic Mean</a>.  <a href="namespacemom__lateral__boundary__diffusion.html#a6c98f54ad462ab45918fdccc0b403948">More...</a><br /></td></tr>
<tr class="separator:a6c98f54ad462ab45918fdccc0b403948"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9cd84e0a8f4ddaba3c8ece5f149c7a9f"><td class="memItemLeft" align="right" valign="top">subroutine, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__lateral__boundary__diffusion.html#a9cd84e0a8f4ddaba3c8ece5f149c7a9f">boundary_k_range</a> (boundary, nk, h, hbl, k_top, zeta_top, k_bot, zeta_bot)</td></tr>
<tr class="memdesc:a9cd84e0a8f4ddaba3c8ece5f149c7a9f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Find the k-index range corresponding to the layers that are within the boundary-layer region.  <a href="namespacemom__lateral__boundary__diffusion.html#a9cd84e0a8f4ddaba3c8ece5f149c7a9f">More...</a><br /></td></tr>
<tr class="separator:a9cd84e0a8f4ddaba3c8ece5f149c7a9f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a35884fe17f3fd06e1a212f35a13041c1"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__lateral__boundary__diffusion.html#a35884fe17f3fd06e1a212f35a13041c1">fluxes_layer_method</a> (boundary, nk, deg, h_L, h_R, hbl_L, hbl_R, area_L, area_R, phi_L, phi_R, ppoly0_coefs_L, ppoly0_coefs_R, ppoly0_E_L, ppoly0_E_R, method, khtr_u, F_layer)</td></tr>
<tr class="memdesc:a35884fe17f3fd06e1a212f35a13041c1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate the lateral boundary diffusive fluxes using the layer by layer method. See <a class="el" href="namespacemom__lbd.html#section_method2">Along layer approach (Method #2)</a>.  <a href="namespacemom__lateral__boundary__diffusion.html#a35884fe17f3fd06e1a212f35a13041c1">More...</a><br /></td></tr>
<tr class="separator:a35884fe17f3fd06e1a212f35a13041c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5482d0612f4d387c7bc9d11edd6f042"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__lateral__boundary__diffusion.html#ab5482d0612f4d387c7bc9d11edd6f042">fluxes_bulk_method</a> (boundary, nk, deg, h_L, h_R, hbl_L, hbl_R, area_L, area_R, phi_L, phi_R, ppoly0_coefs_L, ppoly0_coefs_R, ppoly0_E_L, ppoly0_E_R, method, khtr_u, F_bulk, F_layer, F_limit)</td></tr>
<tr class="memdesc:ab5482d0612f4d387c7bc9d11edd6f042"><td class="mdescLeft">&#160;</td><td class="mdescRight">Apply the lateral boundary diffusive fluxes calculated from a 'bulk model' See <a class="el" href="namespacemom__lbd.html#section_method1">Bulk layer approach (Method #1)</a>.  <a href="namespacemom__lateral__boundary__diffusion.html#ab5482d0612f4d387c7bc9d11edd6f042">More...</a><br /></td></tr>
<tr class="separator:ab5482d0612f4d387c7bc9d11edd6f042"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5590830aab282e34bcd5d4df052d4578"><td class="memItemLeft" align="right" valign="top">logical function, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__lateral__boundary__diffusion.html#a5590830aab282e34bcd5d4df052d4578">near_boundary_unit_tests</a> (verbose)</td></tr>
<tr class="memdesc:a5590830aab282e34bcd5d4df052d4578"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unit tests for near-boundary horizontal mixing.  <a href="namespacemom__lateral__boundary__diffusion.html#a5590830aab282e34bcd5d4df052d4578">More...</a><br /></td></tr>
<tr class="separator:a5590830aab282e34bcd5d4df052d4578"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9c689c24bc59f46aa960b33119fe7e59"><td class="memItemLeft" align="right" valign="top">logical function&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__lateral__boundary__diffusion.html#a9c689c24bc59f46aa960b33119fe7e59">test_layer_fluxes</a> (verbose, nk, test_name, F_calc, F_ans)</td></tr>
<tr class="memdesc:a9c689c24bc59f46aa960b33119fe7e59"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns true if output of near-boundary unit tests does not match correct computed values and conditionally writes results to stream.  <a href="namespacemom__lateral__boundary__diffusion.html#a9c689c24bc59f46aa960b33119fe7e59">More...</a><br /></td></tr>
<tr class="separator:a9c689c24bc59f46aa960b33119fe7e59"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac7d1d46aeb36ab434b1a6533b47246ce"><td class="memItemLeft" align="right" valign="top">logical function&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__lateral__boundary__diffusion.html#ac7d1d46aeb36ab434b1a6533b47246ce">test_boundary_k_range</a> (k_top, zeta_top, k_bot, zeta_bot, k_top_ans, zeta_top_ans, k_bot_ans, zeta_bot_ans, test_name, verbose)</td></tr>
<tr class="memdesc:ac7d1d46aeb36ab434b1a6533b47246ce"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return true if output of unit tests for boundary_k_range does not match answers.  <a href="namespacemom__lateral__boundary__diffusion.html#ac7d1d46aeb36ab434b1a6533b47246ce">More...</a><br /></td></tr>
<tr class="separator:ac7d1d46aeb36ab434b1a6533b47246ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ace1430e08cc68a474c478e53f955c715"><td class="memItemLeft" align="right" valign="top">integer, parameter, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__lateral__boundary__diffusion.html#ace1430e08cc68a474c478e53f955c715">surface</a> = -1</td></tr>
<tr class="memdesc:ace1430e08cc68a474c478e53f955c715"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set a value that corresponds to the surface bopundary.  <a href="namespacemom__lateral__boundary__diffusion.html#ace1430e08cc68a474c478e53f955c715">More...</a><br /></td></tr>
<tr class="separator:ace1430e08cc68a474c478e53f955c715"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2d5308bf15dc0816cdbef33287152b4a"><td class="memItemLeft" align="right" valign="top">integer, parameter, public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__lateral__boundary__diffusion.html#a2d5308bf15dc0816cdbef33287152b4a">bottom</a> = 1</td></tr>
<tr class="memdesc:a2d5308bf15dc0816cdbef33287152b4a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set a value that corresponds to the bottom boundary.  <a href="namespacemom__lateral__boundary__diffusion.html#a2d5308bf15dc0816cdbef33287152b4a">More...</a><br /></td></tr>
<tr class="separator:a2d5308bf15dc0816cdbef33287152b4a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a61c6b3e00d03dafc0c7625788a787b10"><td class="memItemLeft" align="right" valign="top"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=40)&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacemom__lateral__boundary__diffusion.html#a61c6b3e00d03dafc0c7625788a787b10">mdl</a> = &quot;MOM_lateral_boundary_diffusion&quot;</td></tr>
<tr class="memdesc:a61c6b3e00d03dafc0c7625788a787b10"><td class="mdescLeft">&#160;</td><td class="mdescRight">Name of this module.  <a href="namespacemom__lateral__boundary__diffusion.html#a61c6b3e00d03dafc0c7625788a787b10">More...</a><br /></td></tr>
<tr class="separator:a61c6b3e00d03dafc0c7625788a787b10"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="a9cd84e0a8f4ddaba3c8ece5f149c7a9f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9cd84e0a8f4ddaba3c8ece5f149c7a9f">&#9670;&nbsp;</a></span>boundary_k_range()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_lateral_boundary_diffusion::boundary_k_range </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>boundary</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk), intent(in)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>hbl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(out)&#160;</td>
          <td class="paramname"><em>k_top</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(out)&#160;</td>
          <td class="paramname"><em>zeta_top</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(out)&#160;</td>
          <td class="paramname"><em>k_bot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(out)&#160;</td>
          <td class="paramname"><em>zeta_bot</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Find the k-index range corresponding to the layers that are within the boundary-layer region. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">boundary</td><td>SURFACE or BOTTOM [nondim] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nk</td><td>Number of layers [nondim] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h</td><td>Layer thicknesses of the column [m] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">hbl</td><td>Thickness of the boundary layer [m] If surface, with respect to zbl_ref = 0. If bottom, with respect to zbl_ref = SUM(h) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">k_top</td><td>Index of the first layer within the boundary </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">zeta_top</td><td>Distance from the top of a layer to the intersection of the top extent of the boundary layer (0 at top, 1 at bottom) [nondim] </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">k_bot</td><td>Index of the last layer within the boundary </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">zeta_bot</td><td>Distance of the lower layer to the boundary layer depth (0 at top, 1 at bottom) [nondim] </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00356">356</a> of file <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html">MOM_lateral_boundary_diffusion.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <span class="keywordtype">integer</span>,             <span class="keywordtype">intent(in   )</span> :: boundary<span class="comment"> !&lt; SURFACE or BOTTOM                       [nondim]</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  <span class="keywordtype">integer</span>,             <span class="keywordtype">intent(in   )</span> :: nk<span class="comment">       !&lt; Number of layers                        [nondim]</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(nk)</span>, <span class="keywordtype">intent(in   )</span> :: h<span class="comment">        !&lt; Layer thicknesses of the column         [m]</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="keywordtype">  real</span>,                <span class="keywordtype">intent(in   )</span> :: hbl<span class="comment">      !&lt; Thickness of the boundary layer         [m]</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment">                                                 !! If surface, with respect to zbl_ref = 0.</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment">                                                 !! If bottom, with respect to zbl_ref = SUM(h)</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  <span class="keywordtype">integer</span>,             <span class="keywordtype">intent(  out)</span> :: k_top<span class="comment">    !&lt; Index of the first layer within the boundary</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="keywordtype">  real</span>,                <span class="keywordtype">intent(  out)</span> :: zeta_top<span class="comment"> !&lt; Distance from the top of a layer to the intersection of the</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment">                                                 !! top extent of the boundary layer (0 at top, 1 at bottom)  [nondim]</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  <span class="keywordtype">integer</span>,             <span class="keywordtype">intent(  out)</span> :: k_bot<span class="comment">    !&lt; Index of the last layer within the boundary</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="keywordtype">  real</span>,                <span class="keywordtype">intent(  out)</span> :: zeta_bot<span class="comment"> !&lt; Distance of the lower layer to the boundary layer depth</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">                                                 !! (0 at top, 1 at bottom)  [nondim]</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="keywordtype">  real</span> :: htot</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  <span class="keywordtype">integer</span> :: k</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  <span class="comment">! Surface boundary layer</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  <span class="keywordflow">if</span> ( boundary == surface ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    k_top = 1</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    zeta_top = 0.</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    htot = 0.</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    k_bot = 1</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    zeta_bot = 0.</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    <span class="keywordflow">if</span> (hbl == 0.) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="keywordflow">if</span> (hbl &gt;= sum(h(:))) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;      k_bot = nk</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;      zeta_bot = 0.</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;      <span class="keywordflow">return</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="keywordflow">do</span> k=1,nk</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      htot = htot + h(k)</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      <span class="keywordflow">if</span> ( htot &gt;= hbl) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        k_bot = k</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        zeta_bot = 1 - (htot - hbl)/h(k)</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        <span class="keywordflow">return</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  <span class="comment">! Bottom boundary layer</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  <span class="keywordflow">elseif</span> ( boundary == bottom ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    k_top = nk</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    zeta_top = 1.</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    k_bot = nk</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    zeta_bot = 1.</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    htot = 0.</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="keywordflow">if</span> (hbl == 0.) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="keywordflow">if</span> (hbl &gt;= sum(h(:))) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;      k_top = 1</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;      zeta_top = 0.</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      <span class="keywordflow">return</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    <span class="keywordflow">do</span> k=nk,1,-1</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;      htot = htot + h(k)</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;      <span class="keywordflow">if</span> (htot &gt;= hbl) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        k_top = k</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        zeta_top = 1 - (htot - hbl)/h(k)</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        <span class="keywordflow">return</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <span class="keyword">call </span>mom_error(fatal,<span class="stringliteral">&quot;Houston, we&#39;ve had a problem in boundary_k_range&quot;</span>)</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00034">bottom</a>, <a class="el" href="MOM__error__handler_8F90_source.html#l00072">mom_error_handler::mom_error()</a>, and <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00033">surface</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00537">fluxes_bulk_method()</a>, <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00424">fluxes_layer_method()</a>, <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00714">near_boundary_unit_tests()</a>, and <a class="el" href="MOM__neutral__diffusion_8F90_source.html#l00264">mom_neutral_diffusion::neutral_diffusion_calc_coeffs()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__lateral__boundary__diffusion_a9cd84e0a8f4ddaba3c8ece5f149c7a9f_cgraph.svg" width="543" height="67"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__lateral__boundary__diffusion_a9cd84e0a8f4ddaba3c8ece5f149c7a9f_icgraph.svg" width="100%" height="484"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a764405ce85234799f6b81be25a8df1b7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a764405ce85234799f6b81be25a8df1b7">&#9670;&nbsp;</a></span>bulk_average()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">real function mom_lateral_boundary_diffusion::bulk_average </td>
          <td>(</td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>boundary</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>nk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>deg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real&#160;</td>
          <td class="paramname"><em>hBLT</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk)&#160;</td>
          <td class="paramname"><em>phi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:)&#160;</td>
          <td class="paramname"><em>ppoly0_E</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:,:)&#160;</td>
          <td class="paramname"><em>ppoly0_coefs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>method</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>k_top</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real&#160;</td>
          <td class="paramname"><em>zeta_top</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>k_bot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real&#160;</td>
          <td class="paramname"><em>zeta_bot</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">boundary</td><td>SURFACE or BOTTOM [nondim]</td></tr>
    <tr><td class="paramname">nk</td><td>Number of layers [nondim]</td></tr>
    <tr><td class="paramname">deg</td><td>Degree of polynomial [nondim]</td></tr>
    <tr><td class="paramname">h</td><td>Layer thicknesses [m]</td></tr>
    <tr><td class="paramname">hblt</td><td>Depth of the boundary layer [m]</td></tr>
    <tr><td class="paramname">phi</td><td>Scalar quantity</td></tr>
    <tr><td class="paramname">ppoly0_e</td><td>Edge value of polynomial</td></tr>
    <tr><td class="paramname">ppoly0_coefs</td><td>Coefficients of polynomial</td></tr>
    <tr><td class="paramname">method</td><td>Remapping scheme to use</td></tr>
    <tr><td class="paramname">k_top</td><td>Index of the first layer within the boundary</td></tr>
    <tr><td class="paramname">zeta_top</td><td>Fraction of the layer encompassed by the bottom boundary layer (0 if none, 1. if all). For the surface, this is always 0. because integration starts at the surface [nondim]</td></tr>
    <tr><td class="paramname">k_bot</td><td>Index of the last layer within the boundary</td></tr>
    <tr><td class="paramname">zeta_bot</td><td>Fraction of the layer encompassed by the surface boundary layer (0 if none, 1. if all). For the bottom boundary layer, this is always 1. because integration starts at the bottom [nondim] </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00293">293</a> of file <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html">MOM_lateral_boundary_diffusion.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  <span class="keywordtype">integer</span>             :: boundary<span class="comment">          !&lt; SURFACE or BOTTOM                                         [nondim]</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  <span class="keywordtype">integer</span>             :: nk<span class="comment">                !&lt; Number of layers                                          [nondim]</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  <span class="keywordtype">integer</span>             :: deg<span class="comment">               !&lt; Degree of polynomial                                      [nondim]</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(nk)</span> :: h<span class="comment">                 !&lt; Layer thicknesses                                         [m]</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="keywordtype">  real</span>                :: hBLT<span class="comment">              !&lt; Depth of the boundary layer                               [m]</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(nk)</span> :: phi<span class="comment">               !&lt; Scalar quantity</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(nk,2)</span>    :: ppoly0_E(:,:)<span class="comment">      !&lt; Edge value of polynomial</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(nk,deg+1)</span> :: ppoly0_coefs(:,:)<span class="comment"> !&lt; Coefficients of polynomial</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  <span class="keywordtype">integer</span>                   :: method<span class="comment">            !&lt; Remapping scheme to use</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160; </div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  <span class="keywordtype">integer</span>             :: k_top<span class="comment">             !&lt; Index of the first layer within the boundary</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="keywordtype">  real</span>                :: zeta_top<span class="comment">          !&lt; Fraction of the layer encompassed by the bottom boundary layer</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">                                           !! (0 if none, 1. if all). For the surface, this is always 0. because</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">                                           !! integration starts at the surface                         [nondim]</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  <span class="keywordtype">integer</span>             :: k_bot<span class="comment">             !&lt; Index of the last layer within the boundary</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="keywordtype">  real</span>                :: zeta_bot<span class="comment">          !&lt; Fraction of the layer encompassed by the surface boundary layer</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">                                           !! (0 if none, 1. if all). For the bottom boundary layer, this is always 1.</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">                                           !! because integration starts at the bottom                  [nondim]</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="keywordtype">  real</span>    :: htot<span class="comment"> !&lt; Running sum of the thicknesses (top to bottom)</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  <span class="keywordtype">integer</span> :: k<span class="comment">    !&lt; k indice</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160; </div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160; </div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  htot = 0.</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;  bulk_average = 0.</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  <span class="keywordflow">if</span> (hblt == 0.) <span class="keywordflow">return</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;  <span class="keywordflow">if</span> (boundary == surface) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    htot = (h(k_bot) * zeta_bot)</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    bulk_average = average_value_ppoly( nk, phi, ppoly0_e, ppoly0_coefs, method, k_bot, 0., zeta_bot) * htot</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="keywordflow">do</span> k = k_bot-1,1,-1</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      bulk_average = bulk_average + phi(k)*h(k)</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      htot = htot + h(k)</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  <span class="keywordflow">elseif</span> (boundary == bottom) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    htot = (h(k_top) * zeta_top)</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="comment">! (note 1-zeta_top because zeta_top is the fraction of the layer)</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    bulk_average = average_value_ppoly( nk, phi, ppoly0_e, ppoly0_coefs, method, k_top, (1.-zeta_top), 1.) * htot</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="keywordflow">do</span> k = k_top+1,nk</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;      bulk_average = bulk_average + phi(k)*h(k)</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      htot = htot + h(k)</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;bulk_average: a valid boundary type must be provided.&quot;</span>)</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160; </div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  bulk_average = bulk_average / hblt</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__remapping_8F90_source.html#l00926">mom_remapping::average_value_ppoly()</a>, <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00034">bottom</a>, <a class="el" href="MOM__error__handler_8F90_source.html#l00072">mom_error_handler::mom_error()</a>, and <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00033">surface</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00537">fluxes_bulk_method()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__lateral__boundary__diffusion_a764405ce85234799f6b81be25a8df1b7_cgraph.svg" width="100%" height="361"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__lateral__boundary__diffusion_a764405ce85234799f6b81be25a8df1b7_icgraph.svg" width="100%" height="410"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="ab5482d0612f4d387c7bc9d11edd6f042"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab5482d0612f4d387c7bc9d11edd6f042">&#9670;&nbsp;</a></span>fluxes_bulk_method()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_lateral_boundary_diffusion::fluxes_bulk_method </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>boundary</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>deg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk), intent(in)&#160;</td>
          <td class="paramname"><em>h_L</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk), intent(in)&#160;</td>
          <td class="paramname"><em>h_R</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>hbl_L</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>hbl_R</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>area_L</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>area_R</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk), intent(in)&#160;</td>
          <td class="paramname"><em>phi_L</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk), intent(in)&#160;</td>
          <td class="paramname"><em>phi_R</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk,deg+1), intent(in)&#160;</td>
          <td class="paramname"><em>ppoly0_coefs_L</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk,deg+1), intent(in)&#160;</td>
          <td class="paramname"><em>ppoly0_coefs_R</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk,2), intent(in)&#160;</td>
          <td class="paramname"><em>ppoly0_E_L</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk,2), intent(in)&#160;</td>
          <td class="paramname"><em>ppoly0_E_R</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>method</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>khtr_u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(out)&#160;</td>
          <td class="paramname"><em>F_bulk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk), intent(out)&#160;</td>
          <td class="paramname"><em>F_layer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk), intent(out), optional&#160;</td>
          <td class="paramname"><em>F_limit</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Apply the lateral boundary diffusive fluxes calculated from a 'bulk model' See <a class="el" href="namespacemom__lbd.html#section_method1">Bulk layer approach (Method #1)</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">boundary</td><td>Which boundary layer SURFACE or BOTTOM [nondim] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nk</td><td>Number of layers [nondim] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">deg</td><td>order of the polynomial reconstruction [nondim] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h_l</td><td>Layer thickness (left) [m] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h_r</td><td>Layer thickness (right) [m] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">hbl_l</td><td>Thickness of the boundary boundary layer (left) [m] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">hbl_r</td><td>Thickness of the boundary boundary layer (left) [m] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">area_l</td><td>Area of the horizontal grid (left) [m^2] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">area_r</td><td>Area of the horizontal grid (right) [m^2] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">phi_l</td><td>Tracer values (left) [conc] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">phi_r</td><td>Tracer values (right) [conc] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ppoly0_coefs_l</td><td>Tracer reconstruction (left) [conc] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ppoly0_coefs_r</td><td>Tracer reconstruction (right) [conc] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ppoly0_e_l</td><td>Polynomial edge values (left) [nondim] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ppoly0_e_r</td><td>Polynomial edge values (right) [nondim] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">method</td><td>Method of polynomial integration [nondim] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">khtr_u</td><td>Horizontal diffusivities times delta t at U-point [m^2] </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">f_bulk</td><td>The bulk mixed layer lateral flux [m^3 conc] </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">f_layer</td><td>Layerwise diffusive flux at U-point [m^3 conc] </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">f_limit</td><td>The amount of flux not applied due to limiter F_layer(k) - F_max [m^3 conc] </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00537">537</a> of file <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html">MOM_lateral_boundary_diffusion.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160; </div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;  <span class="keywordtype">integer</span>,                   <span class="keywordtype">intent(in   )</span>       :: boundary<span class="comment"> !&lt; Which boundary layer SURFACE or BOTTOM  [nondim]</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;  <span class="keywordtype">integer</span>,                   <span class="keywordtype">intent(in   )</span>       :: nk<span class="comment">       !&lt; Number of layers                        [nondim]</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  <span class="keywordtype">integer</span>,                   <span class="keywordtype">intent(in   )</span>       :: deg<span class="comment">      !&lt; order of the polynomial reconstruction  [nondim]</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(nk)</span>,       <span class="keywordtype">intent(in   )</span>       :: h_L<span class="comment">      !&lt; Layer thickness (left)                  [m]</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(nk)</span>,       <span class="keywordtype">intent(in   )</span>       :: h_R<span class="comment">      !&lt; Layer thickness (right)                 [m]</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="keywordtype">  real</span>,                      <span class="keywordtype">intent(in   )</span>       :: hbl_L<span class="comment">    !&lt; Thickness of the boundary boundary</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="comment">                                                                       !! layer (left)                  [m]</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="keywordtype">  real</span>,                      <span class="keywordtype">intent(in   )</span>       :: hbl_R<span class="comment">    !&lt; Thickness of the boundary boundary</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="comment">                                                             !! layer (left)                            [m]</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="keywordtype">  real</span>,                      <span class="keywordtype">intent(in   )</span>       :: area_L<span class="comment">   !&lt; Area of the horizontal grid (left)      [m^2]</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="keywordtype">  real</span>,                      <span class="keywordtype">intent(in   )</span>       :: area_R<span class="comment">   !&lt; Area of the horizontal grid (right)     [m^2]</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(nk)</span>,       <span class="keywordtype">intent(in   )</span>       :: phi_L<span class="comment">    !&lt; Tracer values (left)                    [conc]</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(nk)</span>,       <span class="keywordtype">intent(in   )</span>       :: phi_R<span class="comment">    !&lt; Tracer values (right)                   [conc]</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(nk,deg+1)</span>, <span class="keywordtype">intent(in   )</span>       :: ppoly0_coefs_L<span class="comment"> !&lt; Tracer reconstruction (left)      [conc]</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(nk,deg+1)</span>, <span class="keywordtype">intent(in   )</span>       :: ppoly0_coefs_R<span class="comment"> !&lt; Tracer reconstruction (right)     [conc]</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(nk,2)</span>,     <span class="keywordtype">intent(in   )</span>       :: ppoly0_E_L<span class="comment"> !&lt; Polynomial edge values (left)         [nondim]</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(nk,2)</span>,     <span class="keywordtype">intent(in   )</span>       :: ppoly0_E_R<span class="comment"> !&lt; Polynomial edge values (right)        [nondim]</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  <span class="keywordtype">integer</span>,                   <span class="keywordtype">intent(in   )</span>       :: method<span class="comment">   !&lt; Method of polynomial integration        [nondim]</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="keywordtype">  real</span>,                      <span class="keywordtype">intent(in   )</span>       :: khtr_u<span class="comment">   !&lt; Horizontal diffusivities times delta t at U-point [m^2]</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="keywordtype">  real</span>,                      <span class="keywordtype">intent(  out)</span>       :: F_bulk<span class="comment">   !&lt; The bulk mixed layer lateral flux       [m^3 conc]</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(nk)</span>,       <span class="keywordtype">intent(  out)</span>       :: F_layer<span class="comment">  !&lt; Layerwise diffusive flux at U-point     [m^3 conc]</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">optional</span>, <span class="keywordtype">dimension(nk)</span>, <span class="keywordtype">intent(  out)</span>   :: F_limit<span class="comment">  !&lt; The amount of flux not applied due to limiter</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="comment">                                                             !! F_layer(k) - F_max                      [m^3 conc]</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(nk)</span> :: h_means<span class="comment">              !&lt; Calculate the layer-wise harmonic means           [m]</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="keywordtype">  real</span>                :: khtr_avg<span class="comment">             !&lt; Thickness-weighted diffusivity at the u-point     [m^2 s^-1]</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="comment">                                              !! This is just to remind developers that khtr_avg should be</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="comment">                                              !! computed once khtr is 3D.</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="keywordtype">  real</span>                :: heff<span class="comment">                 !&lt; Harmonic mean of layer thicknesses                [m]</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="keywordtype">  real</span>                :: inv_heff<span class="comment">             !&lt; Inverse of the harmonic mean of layer thicknesses [m^[-1]</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="keywordtype">  real</span>                :: phi_L_avg, phi_R_avg<span class="comment"> !&lt; Bulk, thickness-weighted tracer averages (left and right column)</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="comment">                                              !!                                                   [conc m^-3 ]</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="keywordtype">  real</span>    :: htot                             <span class="comment">! Total column thickness [m]</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  <span class="keywordtype">integer</span> :: k, k_min, k_max<span class="comment">                  !&lt; k-indices, min and max for top and bottom, respectively</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;  <span class="keywordtype">integer</span> :: k_top_L, k_bot_L<span class="comment">                 !&lt; k-indices left</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;  <span class="keywordtype">integer</span> :: k_top_R, k_bot_R<span class="comment">                 !&lt; k-indices right</span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="keywordtype">  real</span>    :: zeta_top_L, zeta_top_R<span class="comment">           !&lt; distance from the top of a layer to the</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="comment">                                              !! boundary layer   [nondim]</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="keywordtype">  real</span>    :: zeta_bot_L, zeta_bot_R<span class="comment">           !&lt; distance from the bottom of a layer to the</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="comment">                                              !! boundary layer   [nondim]</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="keywordtype">  real</span>    :: h_work_L, h_work_R<span class="comment">               !&lt; dummy variables</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="keywordtype">  real</span>    :: F_max<span class="comment">                            !&lt; The maximum amount of flux that can leave a</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="comment">                                              !! cell  [m^3 conc]</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;  <span class="keywordtype">logical</span> :: limited<span class="comment">                          !&lt; True if the flux limiter was applied</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="keywordtype">  real</span>    :: hfrac, F_bulk_remain</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160; </div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;  <span class="keywordflow">if</span> (hbl_l == 0. .or. hbl_r == 0.) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    f_bulk = 0.</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    f_layer(:) = 0.</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="keywordflow">return</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160; </div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  <span class="comment">! Calculate vertical indices containing the boundary layer</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;  <span class="keyword">call </span>boundary_k_range(boundary, nk, h_l, hbl_l, k_top_l, zeta_top_l, k_bot_l, zeta_bot_l)</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;  <span class="keyword">call </span>boundary_k_range(boundary, nk, h_r, hbl_r, k_top_r, zeta_top_r, k_bot_r, zeta_bot_r)</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160; </div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;  <span class="comment">! Calculate bulk averages of various quantities</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;  phi_l_avg  = bulk_average(boundary, nk, deg, h_l, hbl_l, phi_l, ppoly0_e_l, ppoly0_coefs_l, method, k_top_l, &amp;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                            zeta_top_l, k_bot_l, zeta_bot_l)</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;  phi_r_avg  = bulk_average(boundary, nk, deg, h_r, hbl_r, phi_r, ppoly0_e_r, ppoly0_coefs_r, method, k_top_r, &amp;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;                            zeta_top_r, k_bot_r, zeta_bot_r)</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160; </div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;  <span class="comment">! Calculate the &#39;bulk&#39; diffusive flux from the bulk averaged quantities</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;  <span class="comment">! GMM, khtr_avg should be computed once khtr is 3D</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;  heff = harmonic_mean(hbl_l, hbl_r)</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;  f_bulk = -(khtr_u * heff) * (phi_r_avg - phi_l_avg)</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  f_bulk_remain = f_bulk</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;  <span class="comment">! Calculate the layerwise sum of the vertical effective thickness. This is different than the heff calculated</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;  <span class="comment">! above, but is used as a way to decompose the fluxes onto the individual layers</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;  h_means(:) = 0.</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160; </div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  <span class="keywordflow">if</span> (boundary == surface) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    k_min = min(k_bot_l, k_bot_r)</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160; </div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <span class="comment">! left hand side</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    <span class="keywordflow">if</span> (k_bot_l == k_min) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;      h_work_l = h_l(k_min) * zeta_bot_l</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;      h_work_l = h_l(k_min)</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160; </div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    <span class="comment">! right hand side</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    <span class="keywordflow">if</span> (k_bot_r == k_min) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;      h_work_r = h_r(k_min) * zeta_bot_r</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;      h_work_r = h_r(k_min)</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160; </div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    h_means(k_min) = harmonic_mean(h_work_l,h_work_r)</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160; </div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <span class="keywordflow">do</span> k=1,k_min-1</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;      h_means(k) = harmonic_mean(h_l(k),h_r(k))</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160; </div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  <span class="keywordflow">elseif</span> (boundary == bottom) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    k_max = max(k_top_l, k_top_r)</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    <span class="comment">! left hand side</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    <span class="keywordflow">if</span> (k_top_l == k_max) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;      h_work_l = h_l(k_max) * zeta_top_l</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;      h_work_l = h_l(k_max)</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160; </div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="comment">! right hand side</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="keywordflow">if</span> (k_top_r == k_max) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;      h_work_r = h_r(k_max) * zeta_top_r</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;      h_work_r = h_r(k_max)</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160; </div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    h_means(k_max) = harmonic_mean(h_work_l,h_work_r)</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160; </div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <span class="keywordflow">do</span> k=nk,k_max+1,-1</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;      h_means(k) = harmonic_mean(h_l(k),h_r(k))</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160; </div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  <span class="keywordflow">if</span> ( sum(h_means) == 0. ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    <span class="keywordflow">return</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160; <span class="comment">! Decompose the bulk flux onto the individual layers</span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    <span class="comment">! Initialize remaining thickness</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    inv_heff = 1./sum(h_means)</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    <span class="keywordflow">do</span> k=1,nk</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;      <span class="keywordflow">if</span> (h_means(k) &gt; 0.) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        hfrac = h_means(k)*inv_heff</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;        f_layer(k) = f_bulk * hfrac</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        <span class="comment">! limit the flux to 0.2 of the tracer *gradient*</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;        <span class="comment">! Why 0.2?</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        <span class="comment">!  t=0         t=inf</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        <span class="comment">!   0           .2</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        <span class="comment">! 0 1 0       .2.2.2</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        <span class="comment">!   0           .2</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        <span class="comment">!</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        f_max = -0.2 * ((area_r*(phi_r(k)*h_r(k)))-(area_l*(phi_l(k)*h_r(k))))</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160; </div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;        <span class="comment">! check if bulk flux (or F_layer) and F_max have same direction</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;        <span class="keywordflow">if</span> ( sign(1.,f_bulk) == sign(1., f_max)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;          <span class="comment">! Distribute bulk flux onto layers</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;          <span class="keywordflow">if</span> ( ((boundary == surface) .and. (k == k_min)) .or. ((boundary == bottom) .and. (k == nk)) ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;            f_layer(k) = f_bulk_remain <span class="comment">! GMM, are not using F_bulk_remain for now. Should we keep it?</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;<span class="keywordflow">          endif</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;          f_bulk_remain = f_bulk_remain - f_layer(k)</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160; </div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;          <span class="comment">! Apply flux limiter calculated above</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;          <span class="keywordflow">if</span> (f_max &gt;= 0.) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;            limited = f_layer(k) &gt; f_max</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;            f_layer(k) = min(f_layer(k),f_max)</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;            limited = f_layer(k) &lt; f_max</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;            f_layer(k) = max(f_layer(k),f_max)</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;<span class="keywordflow">          endif</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160; </div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;          <span class="comment">! GMM, again we are not using F_limit. Should we delete it?</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">PRESENT</span>(f_limit)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;            <span class="keywordflow">if</span> (limited) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;              f_limit(k) = f_layer(k) - f_max</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;              f_limit(k) = 0.</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;<span class="keywordflow">            endif</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;<span class="keywordflow">          endif</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;          <span class="comment">! do not apply a flux on this layer</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;          f_bulk_remain = f_bulk_remain - f_layer(k)</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;          f_layer(k) = 0.</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        f_layer(k) = 0.</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00034">bottom</a>, <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00356">boundary_k_range()</a>, <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00293">bulk_average()</a>, <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00345">harmonic_mean()</a>, and <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00033">surface</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00123">lateral_boundary_diffusion()</a>, and <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00714">near_boundary_unit_tests()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__lateral__boundary__diffusion_ab5482d0612f4d387c7bc9d11edd6f042_cgraph.svg" width="100%" height="443"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__lateral__boundary__diffusion_ab5482d0612f4d387c7bc9d11edd6f042_icgraph.svg" width="100%" height="410"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a35884fe17f3fd06e1a212f35a13041c1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a35884fe17f3fd06e1a212f35a13041c1">&#9670;&nbsp;</a></span>fluxes_layer_method()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">subroutine mom_lateral_boundary_diffusion::fluxes_layer_method </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>boundary</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>deg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk), intent(in)&#160;</td>
          <td class="paramname"><em>h_L</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk), intent(in)&#160;</td>
          <td class="paramname"><em>h_R</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>hbl_L</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>hbl_R</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>area_L</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>area_R</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk), intent(in)&#160;</td>
          <td class="paramname"><em>phi_L</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk), intent(in)&#160;</td>
          <td class="paramname"><em>phi_R</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk,deg+1), intent(in)&#160;</td>
          <td class="paramname"><em>ppoly0_coefs_L</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk,deg+1), intent(in)&#160;</td>
          <td class="paramname"><em>ppoly0_coefs_R</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk,2), intent(in)&#160;</td>
          <td class="paramname"><em>ppoly0_E_L</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk,2), intent(in)&#160;</td>
          <td class="paramname"><em>ppoly0_E_R</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>method</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>khtr_u</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk), intent(out)&#160;</td>
          <td class="paramname"><em>F_layer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calculate the lateral boundary diffusive fluxes using the layer by layer method. See <a class="el" href="namespacemom__lbd.html#section_method2">Along layer approach (Method #2)</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">boundary</td><td>Which boundary layer SURFACE or BOTTOM [nondim] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nk</td><td>Number of layers [nondim] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">deg</td><td>order of the polynomial reconstruction [nondim] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h_l</td><td>Layer thickness (left) [m] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h_r</td><td>Layer thickness (right) [m] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">hbl_l</td><td>Thickness of the boundary boundary layer (left) [m] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">hbl_r</td><td>Thickness of the boundary boundary layer (right) [m] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">area_l</td><td>Area of the horizontal grid (left) [m^2] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">area_r</td><td>Area of the horizontal grid (right) [m^2] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">phi_l</td><td>Tracer values (left) [conc] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">phi_r</td><td>Tracer values (right) [conc] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ppoly0_coefs_l</td><td>Tracer reconstruction (left) [conc] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ppoly0_coefs_r</td><td>Tracer reconstruction (right) [conc] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ppoly0_e_l</td><td>Polynomial edge values (left) [ nondim ] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ppoly0_e_r</td><td>Polynomial edge values (right) [ nondim ] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">method</td><td>Method of polynomial integration [ nondim ] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">khtr_u</td><td>Horizontal diffusivities times delta t at U-point [m^2] </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">f_layer</td><td>Layerwise diffusive flux at U- or V-point [m^3 conc] </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00424">424</a> of file <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html">MOM_lateral_boundary_diffusion.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160; </div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  <span class="keywordtype">integer</span>,                   <span class="keywordtype">intent(in   )</span>       :: boundary<span class="comment"> !&lt; Which boundary layer SURFACE or BOTTOM  [nondim]</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  <span class="keywordtype">integer</span>,                   <span class="keywordtype">intent(in   )</span>       :: nk<span class="comment">       !&lt; Number of layers                        [nondim]</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  <span class="keywordtype">integer</span>,                   <span class="keywordtype">intent(in   )</span>       :: deg<span class="comment">      !&lt; order of the polynomial reconstruction  [nondim]</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(nk)</span>,       <span class="keywordtype">intent(in   )</span>       :: h_L<span class="comment">      !&lt; Layer thickness (left)                  [m]</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(nk)</span>,       <span class="keywordtype">intent(in   )</span>       :: h_R<span class="comment">      !&lt; Layer thickness (right)                 [m]</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="keywordtype">  real</span>,                      <span class="keywordtype">intent(in   )</span>       :: hbl_L<span class="comment">    !&lt; Thickness of the boundary boundary</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment">                                                                       !! layer (left)                  [m]</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="keywordtype">  real</span>,                      <span class="keywordtype">intent(in   )</span>       :: hbl_R<span class="comment">    !&lt; Thickness of the boundary boundary</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment">                                                             !! layer (right)                           [m]</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="keywordtype">  real</span>,                      <span class="keywordtype">intent(in   )</span>       :: area_L<span class="comment">   !&lt; Area of the horizontal grid (left)      [m^2]</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="keywordtype">  real</span>,                      <span class="keywordtype">intent(in   )</span>       :: area_R<span class="comment">   !&lt; Area of the horizontal grid (right)     [m^2]</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(nk)</span>,       <span class="keywordtype">intent(in   )</span>       :: phi_L<span class="comment">    !&lt; Tracer values (left)                    [conc]</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(nk)</span>,       <span class="keywordtype">intent(in   )</span>       :: phi_R<span class="comment">    !&lt; Tracer values (right)                   [conc]</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(nk,deg+1)</span>, <span class="keywordtype">intent(in   )</span>       :: ppoly0_coefs_L<span class="comment"> !&lt; Tracer reconstruction (left)      [conc]</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(nk,deg+1)</span>, <span class="keywordtype">intent(in   )</span>       :: ppoly0_coefs_R<span class="comment"> !&lt; Tracer reconstruction (right)     [conc]</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(nk,2)</span>,     <span class="keywordtype">intent(in   )</span>       :: ppoly0_E_L<span class="comment"> !&lt; Polynomial edge values (left)         [ nondim ]</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(nk,2)</span>,     <span class="keywordtype">intent(in   )</span>       :: ppoly0_E_R<span class="comment"> !&lt; Polynomial edge values (right)        [ nondim ]</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  <span class="keywordtype">integer</span>,                   <span class="keywordtype">intent(in   )</span>       :: method<span class="comment">   !&lt; Method of polynomial integration        [ nondim ]</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="keywordtype">  real</span>,                      <span class="keywordtype">intent(in   )</span>       :: khtr_u<span class="comment">   !&lt; Horizontal diffusivities times delta t at U-point [m^2]</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(nk)</span>,       <span class="keywordtype">intent(  out)</span>       :: F_layer<span class="comment">  !&lt; Layerwise diffusive flux at U- or V-point [m^3 conc]</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160; </div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(nk)</span> :: h_means<span class="comment">              !&lt; Calculate the layer-wise harmonic means           [m]</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="keywordtype">  real</span>                :: khtr_avg<span class="comment">             !&lt; Thickness-weighted diffusivity at the u-point     [m^2 s^-1]</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment">                                              !! This is just to remind developers that khtr_avg should be</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="comment">                                              !! computed once khtr is 3D.</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="keywordtype">  real</span>                :: heff<span class="comment">                 !&lt; Harmonic mean of layer thicknesses                [m]</span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="keywordtype">  real</span>                :: inv_heff<span class="comment">             !&lt; Inverse of the harmonic mean of layer thicknesses [m^[-1]</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="keywordtype">  real</span>                :: phi_L_avg, phi_R_avg<span class="comment"> !&lt; Bulk, thickness-weighted tracer averages (left and right column)</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="comment">                                              !!                                                   [conc m^-3 ]</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="keywordtype">  real</span>    :: htot<span class="comment">    !&lt; Total column thickness [m]</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  <span class="keywordtype">integer</span> :: k, k_bot_min, k_top_max<span class="comment">   !&lt; k-indices, min and max for top and bottom, respectively</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  <span class="keywordtype">integer</span> :: k_top_L, k_bot_L<span class="comment">          !&lt; k-indices left</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  <span class="keywordtype">integer</span> :: k_top_R, k_bot_R<span class="comment">          !&lt; k-indices right</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="keywordtype">  real</span>    :: zeta_top_L, zeta_top_R<span class="comment">    !&lt; distance from the top of a layer to the boundary</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment">                                       !! layer depth                                     [nondim]</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="keywordtype">  real</span>    :: zeta_bot_L, zeta_bot_R<span class="comment">    !&lt; distance from the bottom of a layer to the boundary</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment">                                       !!layer depth                                      [nondim]</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="keywordtype">  real</span>    :: h_work_L, h_work_R<span class="comment">  !&lt; dummy variables</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="keywordtype">  real</span>    :: hbl_min<span class="comment">             !&lt; minimum BLD (left and right)                                   [m]</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160; </div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  f_layer(:) = 0.0</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  <span class="keywordflow">if</span> (hbl_l == 0. .or. hbl_r == 0.) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="keywordflow">return</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160; </div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  <span class="comment">! Calculate vertical indices containing the boundary layer</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  <span class="keyword">call </span>boundary_k_range(boundary, nk, h_l, hbl_l, k_top_l, zeta_top_l, k_bot_l, zeta_bot_l)</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  <span class="keyword">call </span>boundary_k_range(boundary, nk, h_r, hbl_r, k_top_r, zeta_top_r, k_bot_r, zeta_bot_r)</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160; </div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  <span class="keywordflow">if</span> (boundary == surface) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    k_bot_min = min(k_bot_l, k_bot_r)</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="comment">! make sure left and right k indices span same range</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="keywordflow">if</span> (k_bot_min .ne. k_bot_l) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;      k_bot_l = k_bot_min</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;      zeta_bot_l = 1.0</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="keywordflow">if</span> (k_bot_min .ne. k_bot_r) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;      k_bot_r= k_bot_min</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;      zeta_bot_r = 1.0</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160; </div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    h_work_l = (h_l(k_bot_l) * zeta_bot_l)</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    h_work_r = (h_r(k_bot_r) * zeta_bot_r)</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160; </div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    phi_l_avg = average_value_ppoly( nk, phi_l, ppoly0_e_l, ppoly0_coefs_l, method, k_bot_l, 0., zeta_bot_l)</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    phi_r_avg = average_value_ppoly( nk, phi_r, ppoly0_e_r, ppoly0_coefs_r, method, k_bot_r, 0., zeta_bot_r)</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    heff = harmonic_mean(h_work_l, h_work_r)</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <span class="comment">! tracer flux where the minimum BLD intersets layer</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <span class="comment">! GMM, khtr_avg should be computed once khtr is 3D</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    f_layer(k_bot_min) = -(heff * khtr_u) * (phi_r_avg - phi_l_avg)</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160; </div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    <span class="keywordflow">do</span> k = k_bot_min-1,1,-1</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;      heff = harmonic_mean(h_l(k), h_r(k))</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;      f_layer(k) = -(heff * khtr_u) * (phi_r(k) - phi_l(k))</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160; </div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  <span class="keywordflow">if</span> (boundary == bottom) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    k_top_max = max(k_top_l, k_top_r)</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <span class="comment">! make sure left and right k indices span same range</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <span class="keywordflow">if</span> (k_top_max .ne. k_top_l) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;      k_top_l = k_top_max</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;      zeta_top_l = 1.0</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <span class="keywordflow">if</span> (k_top_max .ne. k_top_r) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;      k_top_r= k_top_max</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;      zeta_top_r = 1.0</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160; </div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    h_work_l = (h_l(k_top_l) * zeta_top_l)</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    h_work_r = (h_r(k_top_r) * zeta_top_r)</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160; </div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    phi_l_avg = average_value_ppoly( nk, phi_l, ppoly0_e_l, ppoly0_coefs_l, method, k_top_l, 1.0-zeta_top_l, 1.0)</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    phi_r_avg = average_value_ppoly( nk, phi_r, ppoly0_e_r, ppoly0_coefs_r, method, k_top_r, 1.0-zeta_top_r, 1.0)</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    heff = harmonic_mean(h_work_l, h_work_r)</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160; </div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <span class="comment">! tracer flux where the minimum BLD intersets layer</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    f_layer(k_top_max) = (-heff * khtr_u) * (phi_r_avg - phi_l_avg)</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160; </div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="keywordflow">do</span> k = k_top_max+1,nk</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;      heff = harmonic_mean(h_l(k), h_r(k))</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;      f_layer(k) = -(heff * khtr_u) * (phi_r(k) - phi_l(k))</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__remapping_8F90_source.html#l00926">mom_remapping::average_value_ppoly()</a>, <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00034">bottom</a>, <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00356">boundary_k_range()</a>, <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00345">harmonic_mean()</a>, and <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00033">surface</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00123">lateral_boundary_diffusion()</a>, and <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00714">near_boundary_unit_tests()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__lateral__boundary__diffusion_a35884fe17f3fd06e1a212f35a13041c1_cgraph.svg" width="100%" height="449"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__lateral__boundary__diffusion_a35884fe17f3fd06e1a212f35a13041c1_icgraph.svg" width="100%" height="410"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a6c98f54ad462ab45918fdccc0b403948"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6c98f54ad462ab45918fdccc0b403948">&#9670;&nbsp;</a></span>harmonic_mean()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">real function mom_lateral_boundary_diffusion::harmonic_mean </td>
          <td>(</td>
          <td class="paramtype">real&#160;</td>
          <td class="paramname"><em>h1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real&#160;</td>
          <td class="paramname"><em>h2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Calculate the harmonic mean of two quantities See <a class="el" href="namespacemom__lbd.html#section_harmonic_mean">Harmonic Mean</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">h1</td><td>Scalar quantity </td></tr>
    <tr><td class="paramname">h2</td><td>Scalar quantity </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00345">345</a> of file <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html">MOM_lateral_boundary_diffusion.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="keywordtype">  real</span> :: h1<span class="comment"> !&lt; Scalar quantity</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="keywordtype">  real</span> :: h2<span class="comment"> !&lt; Scalar quantity</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  <span class="keywordflow">if</span> (h1 + h2 == 0.) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    harmonic_mean = 0.</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    harmonic_mean = 2.*(h1*h2)/(h1+h2)</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="keywordflow">  endif</span></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00537">fluxes_bulk_method()</a>, and <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00424">fluxes_layer_method()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__lateral__boundary__diffusion_a6c98f54ad462ab45918fdccc0b403948_icgraph.svg" width="100%" height="410"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="afac71bffe2368a84b543f4d7f60703e0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afac71bffe2368a84b543f4d7f60703e0">&#9670;&nbsp;</a></span>lateral_boundary_diffusion()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine, public mom_lateral_boundary_diffusion::lateral_boundary_diffusion </td>
          <td>(</td>
          <td class="paramtype">type(ocean_grid_type), intent(inout)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(verticalgrid_type), intent(in)&#160;</td>
          <td class="paramname"><em>GV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(unit_scale_type), intent(in)&#160;</td>
          <td class="paramname"><em>US</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsd: g %jed, g %ke), intent(in)&#160;</td>
          <td class="paramname"><em>h</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isdb: g %iedb, g %jsd: g %jed), intent(in)&#160;</td>
          <td class="paramname"><em>Coef_x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension( g %isd: g %ied, g %jsdb: g %jedb), intent(in)&#160;</td>
          <td class="paramname"><em>Coef_y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>dt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(tracer_registry_type), pointer&#160;</td>
          <td class="paramname"><em>Reg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__lateral__boundary__diffusion_1_1lateral__boundary__diffusion__cs.html">lateral_boundary_diffusion_cs</a>), intent(in)&#160;</td>
          <td class="paramname"><em>CS</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Driver routine for calculating lateral diffusive fluxes near the top and bottom boundaries. Two different methods are available: Method 1: lower order representation, calculate fluxes from bulk layer integrated quantities. Method 2: more straight forward, diffusion is applied layer by layer using only information from neighboring cells. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">g</td><td>Grid type </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">gv</td><td>ocean vertical grid structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">us</td><td>A dimensional unit scaling type </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">h</td><td>Layer thickness [H ~&gt; m or kg m-2] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">coef_x</td><td>dt * Kh * dy / dx at u-points [m2] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">coef_y</td><td>dt * Kh * dx / dy at v-points [m2] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dt</td><td>Tracer time step * I_numitts (I_numitts in tracer_hordiff) </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">reg</td><td>Tracer registry </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cs</td><td>Control structure for this module </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00123">123</a> of file <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html">MOM_lateral_boundary_diffusion.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),                <span class="keywordtype">intent(inout)</span> :: G<span class="comment">   !&lt; Grid type</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  <span class="keywordtype">type</span>(verticalGrid_type),              <span class="keywordtype">intent(in)</span>    :: GV<span class="comment">  !&lt; ocean vertical grid structure</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;  <span class="keywordtype">type</span>(unit_scale_type),                <span class="keywordtype">intent(in)</span>    :: US<span class="comment">  !&lt; A dimensional unit scaling type</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G))</span>, &amp;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                                        <span class="keywordtype">intent(in)</span>    :: h<span class="comment">      !&lt; Layer thickness [H ~&gt; m or kg m-2]</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G))</span>,    <span class="keywordtype">intent(in)</span>    :: Coef_x<span class="comment"> !&lt; dt * Kh * dy / dx at u-points [m2]</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G))</span>,    <span class="keywordtype">intent(in)</span>    :: Coef_y<span class="comment"> !&lt; dt * Kh * dx / dy at v-points [m2]</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="keywordtype">  real</span>,                                 <span class="keywordtype">intent(in)</span>    :: dt<span class="comment">     !&lt; Tracer time step * I_numitts</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">                                                                !! (I_numitts in tracer_hordiff)</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  <span class="keywordtype">type</span>(tracer_registry_type),           <span class="keywordtype">pointer</span>       :: Reg<span class="comment">    !&lt; Tracer registry</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="keywordtype">type</span>(lateral_boundary_diffusion_CS),  <span class="keywordtype">intent(in)</span>    :: CS<span class="comment">     !&lt; Control structure for this module</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160; </div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G))</span> :: hbl<span class="comment">                           !&lt; bnd. layer depth [m]</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G),CS%deg+1)</span> :: ppoly0_coefs<span class="comment"> !&lt; Coefficients of polynomial</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),SZK_(G),2)</span>        :: ppoly0_E<span class="comment">     !&lt; Edge values from reconstructions</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZK_(G),CS%deg+1)</span>                 :: ppoly_S<span class="comment">      !&lt; Slopes from reconstruction (placeholder)</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G),SZK_(G))</span> :: uFlx<span class="comment">        !&lt; Zonal flux of tracer [conc m^3]</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G))</span>         :: uFLx_bulk<span class="comment">   !&lt; Total calculated bulk-layer u-flux for the tracer</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G),SZK_(G))</span> :: vFlx<span class="comment">        !&lt; Meridional flux of tracer [conc m^3]</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G))</span>         :: vFlx_bulk<span class="comment">   !&lt; Total calculated bulk-layer v-flux for the tracer</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZIB_(G),SZJ_(G))</span>         :: uwork_2d<span class="comment">    !&lt; Layer summed u-flux transport</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJB_(G))</span>         :: vwork_2d<span class="comment">    !&lt; Layer summed v-flux transport</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G),G%ke)</span>     :: tendency<span class="comment">    !&lt; tendency array for diagn</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(SZI_(G),SZJ_(G))</span>          :: tendency_2d<span class="comment"> !&lt; depth integrated content tendency for diagn</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <span class="keywordtype">type</span>(tracer_type), <span class="keywordtype">pointer</span>                :: Tracer =&gt; null() <span class="comment">!&lt; Pointer to the current tracer</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  <span class="keywordtype">integer</span> :: remap_method<span class="comment"> !&lt; Reconstruction method</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  <span class="keywordtype">integer</span> :: i,j,k,m<span class="comment">      !&lt; indices to loop over</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="keywordtype">  real</span>    :: Idt<span class="comment">          !&lt; inverse of the time step [s-1]</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160; </div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  idt = 1./dt</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  hbl(:,:) = 0.</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(cs%KPP_CSp)) <span class="keyword">call </span>kpp_get_bld(cs%KPP_CSp, hbl, g)</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(cs%energetic_PBL_CSp)) <span class="keyword">call </span>energetic_pbl_get_mld(cs%energetic_PBL_CSp, hbl, g, us)</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160; </div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <span class="keyword">call </span>pass_var(hbl,g%Domain)</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <span class="keywordflow">do</span> m = 1,reg%ntr</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    tracer =&gt; reg%tr(m)</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160; </div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="comment">! for diagnostics</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="keywordflow">if</span> (tracer%id_lbdxy_conc &gt; 0 .or. tracer%id_lbdxy_cont &gt; 0 .or. tracer%id_lbdxy_cont_2d &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;      tendency(:,:,:)  = 0.0</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160; </div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    <span class="keywordflow">do</span> j = g%jsc-1, g%jec+1</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;      <span class="comment">! Interpolate state to interface</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;      <span class="keywordflow">do</span> i = g%isc-1, g%iec+1</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;          <span class="keyword">call </span>build_reconstructions_1d( cs%remap_CS, g%ke, h(i,j,:), tracer%t(i,j,:), ppoly0_coefs(i,j,:,:), &amp;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                                         ppoly0_e(i,j,:,:), ppoly_s, remap_method, gv%H_subroundoff, gv%H_subroundoff)</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="keywordflow">    enddo</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="comment">! Diffusive fluxes in the i-direction</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    uflx(:,:,:) = 0.</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    vflx(:,:,:) = 0.</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    uflx_bulk(:,:) = 0.</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    vflx_bulk(:,:) = 0.</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160; </div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="comment">! Method #1</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="keywordflow">if</span> ( cs%method == 1 ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      <span class="keywordflow">do</span> j=g%jsc,g%jec</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <span class="keywordflow">do</span> i=g%isc-1,g%iec</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;          <span class="keywordflow">if</span> (g%mask2dCu(i,j)&gt;0.) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;            <span class="keyword">call </span>fluxes_bulk_method(surface, gv%ke, cs%deg, h(i,j,:), h(i+1,j,:), hbl(i,j), hbl(i+1,j), &amp;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;              g%areaT(i,j), g%areaT(i+1,j), tracer%t(i,j,:), tracer%t(i+1,j,:),                         &amp;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;              ppoly0_coefs(i,j,:,:), ppoly0_coefs(i+1,j,:,:), ppoly0_e(i,j,:,:),                        &amp;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;              ppoly0_e(i+1,j,:,:), remap_method, coef_x(i,j), uflx_bulk(i,j), uflx(i,j,:))</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="keywordflow">          endif</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="keywordflow">        enddo</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      <span class="keywordflow">do</span> j=g%jsc-1,g%jec</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        <span class="keywordflow">do</span> i=g%isc,g%iec</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;          <span class="keywordflow">if</span> (g%mask2dCv(i,j)&gt;0.) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;            <span class="keyword">call </span>fluxes_bulk_method(surface, gv%ke, cs%deg, h(i,j,:), h(i,j+1,:), hbl(i,j), hbl(i,j+1), &amp;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;              g%areaT(i,j), g%areaT(i,j+1), tracer%t(i,j,:), tracer%t(i,j+1,:),                         &amp;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;              ppoly0_coefs(i,j,:,:), ppoly0_coefs(i,j+1,:,:), ppoly0_e(i,j,:,:),                        &amp;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;              ppoly0_e(i,j+1,:,:), remap_method, coef_y(i,j), vflx_bulk(i,j), vflx(i,j,:))</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="keywordflow">          endif</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="keywordflow">        enddo</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      <span class="comment">! Post tracer bulk diags</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      <span class="keywordflow">if</span> (tracer%id_lbd_bulk_dfx&gt;0) <span class="keyword">call </span>post_data(tracer%id_lbd_bulk_dfx, uflx_bulk*idt, cs%diag)</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;      <span class="keywordflow">if</span> (tracer%id_lbd_bulk_dfy&gt;0) <span class="keyword">call </span>post_data(tracer%id_lbd_bulk_dfy, vflx_bulk*idt, cs%diag)</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160; </div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="comment">! Method #2</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keywordflow">elseif</span> (cs%method == 2) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      <span class="keywordflow">do</span> j=g%jsc,g%jec</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <span class="keywordflow">do</span> i=g%isc-1,g%iec</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;          <span class="keywordflow">if</span> (g%mask2dCu(i,j)&gt;0.) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;            <span class="keyword">call </span>fluxes_layer_method(surface, gv%ke, cs%deg, h(i,j,:), h(i+1,j,:), hbl(i,j), hbl(i+1,j), &amp;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;              g%areaT(i,j), g%areaT(i+1,j), tracer%t(i,j,:), tracer%t(i+1,j,:), ppoly0_coefs(i,j,:,:), &amp;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;              ppoly0_coefs(i+1,j,:,:), ppoly0_e(i,j,:,:), ppoly0_e(i+1,j,:,:), remap_method, coef_x(i,j), uflx(i,j,:))</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="keywordflow">          endif</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="keywordflow">        enddo</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      <span class="keywordflow">do</span> j=g%jsc-1,g%jec</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        <span class="keywordflow">do</span> i=g%isc,g%iec</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;          <span class="keywordflow">if</span> (g%mask2dCv(i,j)&gt;0.) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            <span class="keyword">call </span>fluxes_layer_method(surface, gv%ke, cs%deg, h(i,j,:), h(i,j+1,:), hbl(i,j), hbl(i,j+1), &amp;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;              g%areaT(i,j), g%areaT(i,j+1), tracer%t(i,j,:), tracer%t(i,j+1,:), ppoly0_coefs(i,j,:,:), &amp;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;              ppoly0_coefs(i,j+1,:,:), ppoly0_e(i,j,:,:), ppoly0_e(i,j+1,:,:), remap_method, coef_y(i,j), vflx(i,j,:))</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="keywordflow">          endif</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="keywordflow">        enddo</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="keywordflow">      enddo</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160; </div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="comment">! Update the tracer fluxes</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="keywordflow">do</span> k=1,gv%ke ; <span class="keywordflow">do</span> j=g%jsc,g%jec ; <span class="keywordflow">do</span> i=g%isc,g%iec</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      <span class="keywordflow">if</span> (g%mask2dT(i,j)&gt;0.) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        tracer%t(i,j,k) = tracer%t(i,j,k) + (( (uflx(i-1,j,k)-uflx(i,j,k)) ) + ( (vflx(i,j-1,k)-vflx(i,j,k) ) ))* &amp;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                          (g%IareaT(i,j)/( h(i,j,k) + gv%H_subroundoff))</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160; </div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        <span class="keywordflow">if</span> (tracer%id_lbdxy_conc &gt; 0  .or. tracer%id_lbdxy_cont &gt; 0 .or. tracer%id_lbdxy_cont_2d &gt; 0 ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;          tendency(i,j,k) = (( (uflx(i-1,j,k)-uflx(i,j,k)) ) + ( (vflx(i,j-1,k)-vflx(i,j,k) ) )) * g%IareaT(i,j) * idt</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="keywordflow">        endif</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160; </div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="keywordflow">      endif</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="keywordflow">    enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160; </div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="comment">! Post the tracer diagnostics</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="keywordflow">if</span> (tracer%id_lbd_dfx&gt;0)      <span class="keyword">call </span>post_data(tracer%id_lbd_dfx, uflx*idt, cs%diag)</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="keywordflow">if</span> (tracer%id_lbd_dfy&gt;0)      <span class="keyword">call </span>post_data(tracer%id_lbd_dfy, vflx*idt, cs%diag)</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keywordflow">if</span> (tracer%id_lbd_dfx_2d&gt;0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      uwork_2d(:,:) = 0.</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      <span class="keywordflow">do</span> k=1,gv%ke; <span class="keywordflow">do</span> j=g%jsc,g%jec; <span class="keywordflow">do</span> i=g%isc-1,g%iec</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        uwork_2d(i,j) = uwork_2d(i,j) + (uflx(i,j,k) * idt)</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      enddo; enddo;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      <span class="keyword">call </span>post_data(tracer%id_lbd_dfx_2d, uwork_2d, cs%diag)</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160; </div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="keywordflow">if</span> (tracer%id_lbd_dfy_2d&gt;0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      vwork_2d(:,:) = 0.</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      <span class="keywordflow">do</span> k=1,gv%ke; <span class="keywordflow">do</span> j=g%jsc-1,g%jec; <span class="keywordflow">do</span> i=g%isc,g%iec</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        vwork_2d(i,j) = vwork_2d(i,j) + (vflx(i,j,k) * idt)</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      enddo; enddo;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      <span class="keyword">call </span>post_data(tracer%id_lbd_dfy_2d, vwork_2d, cs%diag)</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160; </div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="comment">! post tendency of tracer content</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="keywordflow">if</span> (tracer%id_lbdxy_cont &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      <span class="keyword">call </span>post_data(tracer%id_lbdxy_cont, tendency(:,:,:), cs%diag)</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160; </div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="comment">! post depth summed tendency for tracer content</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="keywordflow">if</span> (tracer%id_lbdxy_cont_2d &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      tendency_2d(:,:) = 0.</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      <span class="keywordflow">do</span> j = g%jsc,g%jec ; <span class="keywordflow">do</span> i = g%isc,g%iec</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        <span class="keywordflow">do</span> k = 1, gv%ke</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;          tendency_2d(i,j) = tendency_2d(i,j) + tendency(i,j,k)</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="keywordflow">        enddo</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;      <span class="keyword">call </span>post_data(tracer%id_lbdxy_cont_2d, tendency_2d(:,:), cs%diag)</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160; </div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="comment">! post tendency of tracer concentration; this step must be</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <span class="comment">! done after posting tracer content tendency, since we alter</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="comment">! the tendency array.</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="keywordflow">if</span> (tracer%id_lbdxy_conc &gt; 0) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      <span class="keywordflow">do</span> k = 1, gv%ke ; <span class="keywordflow">do</span> j = g%jsc,g%jec ; <span class="keywordflow">do</span> i = g%isc,g%iec</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        tendency(i,j,k) =  tendency(i,j,k) / ( h(i,j,k) + gv%H_subroundoff )</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="keywordflow">      enddo</span> ;<span class="keywordflow"> enddo</span> ;<span class="keywordflow"> enddo</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      <span class="keyword">call </span>post_data(tracer%id_lbdxy_conc, tendency, cs%diag)</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160; </div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__energetic__PBL_8F90_source.html#l01920">mom_energetic_pbl::energetic_pbl_get_mld()</a>, <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00537">fluxes_bulk_method()</a>, <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00424">fluxes_layer_method()</a>, <a class="el" href="MOM__CVMix__KPP_8F90_source.html#l01469">mom_cvmix_kpp::kpp_get_bld()</a>, and <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00033">surface</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__tracer__hor__diff_8F90_source.html#l00107">mom_tracer_hor_diff::tracer_hordiff()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__lateral__boundary__diffusion_afac71bffe2368a84b543f4d7f60703e0_cgraph.svg" width="100%" height="509"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__lateral__boundary__diffusion_afac71bffe2368a84b543f4d7f60703e0_icgraph.svg" width="382" height="67"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a4eb098abd02dbf022558e4bedfe9cdef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4eb098abd02dbf022558e4bedfe9cdef">&#9670;&nbsp;</a></span>lateral_boundary_diffusion_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">logical function, public mom_lateral_boundary_diffusion::lateral_boundary_diffusion_init </td>
          <td>(</td>
          <td class="paramtype">type(time_type), intent(in), target&#160;</td>
          <td class="paramname"><em>Time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(ocean_grid_type), intent(in)&#160;</td>
          <td class="paramname"><em>G</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(param_file_type), intent(in)&#160;</td>
          <td class="paramname"><em>param_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(diag_ctrl), intent(inout), target&#160;</td>
          <td class="paramname"><em>diag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(diabatic_cs), pointer&#160;</td>
          <td class="paramname"><em>diabatic_CSp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">type(<a class="el" href="structmom__lateral__boundary__diffusion_1_1lateral__boundary__diffusion__cs.html">lateral_boundary_diffusion_cs</a>), pointer&#160;</td>
          <td class="paramname"><em>CS</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialization routine that reads runtime parameters and sets up pointers to other control structures that might be needed for lateral boundary diffusion. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">time</td><td>Time structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">g</td><td>Grid structure </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_file</td><td>Parameter file structure </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">diag</td><td>Diagnostics control structure </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">diabatic_csp</td><td>KPP control structure needed to get BLD </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">cs</td><td>Lateral boundary mixing control structure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00062">62</a> of file <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html">MOM_lateral_boundary_diffusion.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <span class="keywordtype">type</span>(time_type), <span class="keywordtype">target</span>,          <span class="keywordtype">intent(in)</span>    :: Time<span class="comment">          !&lt; Time structure</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <span class="keywordtype">type</span>(ocean_grid_type),            <span class="keywordtype">intent(in)</span>    :: G<span class="comment">             !&lt; Grid structure</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <span class="keywordtype">type</span>(param_file_type),            <span class="keywordtype">intent(in)</span>    :: param_file<span class="comment">    !&lt; Parameter file structure</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  <span class="keywordtype">type</span>(diag_ctrl), <span class="keywordtype">target</span>,          <span class="keywordtype">intent(inout)</span> :: diag<span class="comment">          !&lt; Diagnostics control structure</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <span class="keywordtype">type</span>(diabatic_CS),                <span class="keywordtype">pointer</span>       :: diabatic_CSp<span class="comment">  !&lt; KPP control structure needed to get BLD</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;  <span class="keywordtype">type</span>(lateral_boundary_diffusion_CS), <span class="keywordtype">pointer</span>    :: CS<span class="comment">            !&lt; Lateral boundary mixing control structure</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160; </div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  <span class="comment">! local variables</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  <span class="keywordtype">character(len=80)</span>  :: string  <span class="comment">! Temporary strings</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="keywordtype">logical</span> :: boundary_extrap</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160; </div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  <span class="keywordflow">if</span> (<span class="keyword">ASSOCIATED</span>(cs)) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keyword">call </span>mom_error(fatal, <span class="stringliteral">&quot;lateral_boundary_diffusion_init called with associated control structure.&quot;</span>)</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="keywordflow">return</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160; </div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <span class="comment">! Log this module and master switch for turning it on/off</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <span class="keyword">call </span>log_version(param_file, mdl, version, &amp;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;       <span class="stringliteral">&quot;This module implements lateral diffusion of tracers near boundaries&quot;</span>)</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;USE_LATERAL_BOUNDARY_DIFFUSION&quot;</span>, lateral_boundary_diffusion_init, &amp;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                 <span class="stringliteral">&quot;If true, enables the lateral boundary tracer&#39;s diffusion module.&quot;</span>, &amp;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                 default=.false.)</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160; </div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="keywordflow">if</span> (.not. lateral_boundary_diffusion_init) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="keywordflow">return</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160; </div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <span class="keyword">allocate</span>(cs)</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  cs%diag =&gt; diag</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <span class="keyword">call </span>extract_diabatic_member(diabatic_csp, kpp_csp=cs%KPP_CSp)</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <span class="keyword">call </span>extract_diabatic_member(diabatic_csp, energetic_pbl_csp=cs%energetic_PBL_CSp)</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160; </div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  cs%surface_boundary_scheme = -1</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="keywordflow">if</span> ( .not. <span class="keyword">ASSOCIATED</span>(cs%energetic_PBL_CSp) .and. .not. <span class="keyword">ASSOCIATED</span>(cs%KPP_CSp) ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="keyword">call </span>mom_error(fatal,<span class="stringliteral">&quot;Lateral boundary diffusion is true, but no valid boundary layer scheme was found&quot;</span>)</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160; </div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <span class="comment">! Read all relevant parameters and write them to the model log.</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;LATERAL_BOUNDARY_METHOD&quot;</span>, cs%method, &amp;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                 <span class="stringliteral">&quot;Determine how to apply boundary lateral diffusion of tracers: \n&quot;</span>//&amp;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                 <span class="stringliteral">&quot;1. Bulk layer approach  \n&quot;</span>//&amp;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                 <span class="stringliteral">&quot;2. Along layer approach&quot;</span>, default=1)</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;LBD_BOUNDARY_EXTRAP&quot;</span>, boundary_extrap, &amp;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                 <span class="stringliteral">&quot;Use boundary extrapolation in LBD code&quot;</span>, &amp;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                 default=.false.)</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  <span class="keyword">call </span>get_param(param_file, mdl, <span class="stringliteral">&quot;LBD_REMAPPING_SCHEME&quot;</span>, string, &amp;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                 <span class="stringliteral">&quot;This sets the reconstruction scheme used &quot;</span>//&amp;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                 <span class="stringliteral">&quot;for vertical remapping for all variables. &quot;</span>//&amp;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                 <span class="stringliteral">&quot;It can be one of the following schemes: &quot;</span>//&amp;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                 trim(remappingschemesdoc), default=remappingdefaultscheme)</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  <span class="keyword">call </span>initialize_remapping( cs%remap_CS, string, boundary_extrapolation = boundary_extrap )</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  <span class="keyword">call </span>extract_member_remapping_cs(cs%remap_CS, degree=cs%deg)</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__diabatic__driver_8F90_source.html#l02865">mom_diabatic_driver::extract_diabatic_member()</a>, <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00055">mdl</a>, <a class="el" href="MOM__error__handler_8F90_source.html#l00072">mom_error_handler::mom_error()</a>, <a class="el" href="MOM__remapping_8F90_source.html#l00069">mom_remapping::remappingdefaultscheme</a>, and <a class="el" href="MOM__remapping_8F90_source.html#l00062">mom_remapping::remappingschemesdoc</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="namespacemom__lateral__boundary__diffusion_a4eb098abd02dbf022558e4bedfe9cdef_cgraph.svg" width="606" height="118"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>

</div>
</div>
<a id="a5590830aab282e34bcd5d4df052d4578"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5590830aab282e34bcd5d4df052d4578">&#9670;&nbsp;</a></span>near_boundary_unit_tests()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">logical function, public mom_lateral_boundary_diffusion::near_boundary_unit_tests </td>
          <td>(</td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>verbose</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Unit tests for near-boundary horizontal mixing. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">verbose</td><td>If true, output additional information for debugging unit tests </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00714">714</a> of file <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html">MOM_lateral_boundary_diffusion.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;  <span class="keywordtype">logical</span>,               <span class="keywordtype">intent(in)</span> :: verbose<span class="comment"> !&lt; If true, output additional information for debugging unit tests</span></div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160; </div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span>    :: nk = 2               <span class="comment">! Number of layers</span></div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span>    :: deg = 1              <span class="comment">! Degree of reconstruction (linear here)</span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span>    :: method = 1           <span class="comment">! Method used for integrating polynomials</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(nk)</span>   :: phi_L, phi_R         <span class="comment">! Tracer values (left and right column)             [ nondim m^-3 ]</span></div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(nk)</span>   :: phi_L_avg, phi_R_avg <span class="comment">! Bulk, thickness-weighted tracer averages (left and right column)</span></div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(nk,deg+1)</span> :: phi_pp_L, phi_pp_R   <span class="comment">! Coefficients for the linear pseudo-reconstructions</span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;                                                <span class="comment">!                                                   [ nondim m^-3 ]</span></div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160; </div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(nk,2)</span> :: ppoly0_E_L, ppoly0_E_R<span class="comment">! Polynomial edge values (left and right)          [concentration]</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(nk)</span>   :: h_L, h_R             <span class="comment">! Layer thickness (left and right)                  [m]</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;<span class="keywordtype">  real</span>                  :: khtr_u               <span class="comment">! Horizontal diffusivities at U-point               [m^2 s^-1]</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;<span class="keywordtype">  real</span>                  :: hbl_L, hbl_R       <span class="comment">! Depth of the boundary layer (left and right)      [m]</span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;<span class="keywordtype">  real</span>                  :: F_bulk               <span class="comment">! Total diffusive flux across the U point           [nondim s^-1]</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(nk)</span>   :: F_layer              <span class="comment">! Diffusive flux within each layer at U-point       [nondim s^-1]</span></div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;<span class="keywordtype">  real</span>                  :: h_u, hblt_u          <span class="comment">! Thickness at the u-point                          [m]</span></div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;<span class="keywordtype">  real</span>                  :: khtr_avg             <span class="comment">! Thickness-weighted diffusivity at the u-point     [m^2 s^-1]</span></div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;<span class="keywordtype">  real</span>                  :: heff                 <span class="comment">! Harmonic mean of layer thicknesses                [m]</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;<span class="keywordtype">  real</span>                  :: inv_heff             <span class="comment">! Inverse of the harmonic mean of layer thicknesses [m^[-1]</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;  <span class="keywordtype">character(len=120)</span>    :: test_name            <span class="comment">! Title of the unit test</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;  <span class="keywordtype">integer</span>               :: k_top                <span class="comment">! Index of cell containing top of boundary</span></div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;<span class="keywordtype">  real</span>                  :: zeta_top             <span class="comment">! Nondimension position</span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;  <span class="keywordtype">integer</span>               :: k_bot                <span class="comment">! Index of cell containing bottom of boundary</span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;<span class="keywordtype">  real</span>                  :: zeta_bot             <span class="comment">! Nondimension position</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;<span class="keywordtype">  real</span>                  :: area_L,area_R        <span class="comment">! Area of grid cell [m^2]</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;  area_l = 1.; area_r = 1. <span class="comment">! Set to unity for all unit tests</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160; </div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;  near_boundary_unit_tests = .false.</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160; </div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;  <span class="comment">! Unit tests for boundary_k_range</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;  test_name = <span class="stringliteral">&#39;Surface boundary spans the entire top cell&#39;</span></div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;  h_l = (/5.,5./)</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;  <span class="keyword">call </span>boundary_k_range(surface, nk, h_l, 5., k_top, zeta_top, k_bot, zeta_bot)</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;  near_boundary_unit_tests = test_boundary_k_range(k_top, zeta_top, k_bot, zeta_bot, 1, 0., 1, 1., test_name, verbose)</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160; </div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;  test_name = <span class="stringliteral">&#39;Surface boundary spans the entire column&#39;</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;  h_l = (/5.,5./)</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;  <span class="keyword">call </span>boundary_k_range(surface, nk, h_l, 10., k_top, zeta_top, k_bot, zeta_bot)</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;  near_boundary_unit_tests = test_boundary_k_range(k_top, zeta_top, k_bot, zeta_bot, 1, 0., 2, 0., test_name, verbose)</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160; </div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;  test_name = <span class="stringliteral">&#39;Bottom boundary spans the entire bottom cell&#39;</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;  h_l = (/5.,5./)</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;  <span class="keyword">call </span>boundary_k_range(bottom, nk, h_l, 5., k_top, zeta_top, k_bot, zeta_bot)</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;  near_boundary_unit_tests = test_boundary_k_range(k_top, zeta_top, k_bot, zeta_bot, 2, 0., 2, 1., test_name, verbose)</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160; </div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;  test_name = <span class="stringliteral">&#39;Bottom boundary spans the entire column&#39;</span></div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;  h_l = (/5.,5./)</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;  <span class="keyword">call </span>boundary_k_range(bottom, nk, h_l, 10., k_top, zeta_top, k_bot, zeta_bot)</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;  near_boundary_unit_tests = test_boundary_k_range(k_top, zeta_top, k_bot, zeta_bot, 1, 0., 2, 1., test_name, verbose)</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160; </div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;  test_name = <span class="stringliteral">&#39;Surface boundary intersects second layer&#39;</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;  h_l = (/10.,10./)</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;  <span class="keyword">call </span>boundary_k_range(surface, nk, h_l, 17.5, k_top, zeta_top, k_bot, zeta_bot)</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;  near_boundary_unit_tests = test_boundary_k_range(k_top, zeta_top, k_bot, zeta_bot, 1, 0., 2, 0.75, test_name, verbose)</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160; </div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;  test_name = <span class="stringliteral">&#39;Surface boundary intersects first layer&#39;</span></div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;  h_l = (/10.,10./)</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;  <span class="keyword">call </span>boundary_k_range(surface, nk, h_l, 2.5, k_top, zeta_top, k_bot, zeta_bot)</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;  near_boundary_unit_tests = test_boundary_k_range(k_top, zeta_top, k_bot, zeta_bot, 1, 0., 1, 0.25, test_name, verbose)</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160; </div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;  test_name = <span class="stringliteral">&#39;Surface boundary is deeper than column thickness&#39;</span></div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  h_l = (/10.,10./)</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;  <span class="keyword">call </span>boundary_k_range(surface, nk, h_l, 21.0, k_top, zeta_top, k_bot, zeta_bot)</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;  near_boundary_unit_tests = test_boundary_k_range(k_top, zeta_top, k_bot, zeta_bot, 1, 0., 2, 0., test_name, verbose)</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160; </div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;  test_name = <span class="stringliteral">&#39;Bottom boundary intersects first layer&#39;</span></div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;  h_l = (/10.,10./)</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;  <span class="keyword">call </span>boundary_k_range(bottom, nk, h_l, 17.5, k_top, zeta_top, k_bot, zeta_bot)</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;  near_boundary_unit_tests = test_boundary_k_range(k_top, zeta_top, k_bot, zeta_bot, 1, 0.75, 2, 1., test_name, verbose)</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160; </div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;  test_name = <span class="stringliteral">&#39;Bottom boundary intersects second layer&#39;</span></div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;  h_l = (/10.,10./)</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;  <span class="keyword">call </span>boundary_k_range(bottom, nk, h_l, 2.5, k_top, zeta_top, k_bot, zeta_bot)</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;  near_boundary_unit_tests = test_boundary_k_range(k_top, zeta_top, k_bot, zeta_bot, 2, 0.25, 2, 1., test_name, verbose)</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160; </div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;  <span class="comment">! All cases in this section have hbl which are equal to the column thicknesses</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;  test_name = <span class="stringliteral">&#39;Equal hbl and same layer thicknesses (gradient from right to left)&#39;</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;  hbl_l = 10; hbl_r = 10</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;  h_l = (/5.,5./) ; h_r = (/5.,5./)</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;  phi_l = (/0.,0./) ; phi_r = (/1.,1./)</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;  phi_pp_l(1,1) = 0.; phi_pp_l(1,2) = 0.</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;  phi_pp_l(2,1) = 0.; phi_pp_l(2,2) = 0.</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  phi_pp_r(1,1) = 1.; phi_pp_r(1,2) = 0.</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;  phi_pp_r(2,1) = 1.; phi_pp_r(2,2) = 0.</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  ppoly0_e_l(1,1) = 0.; ppoly0_e_l(1,2) = 0.</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;  ppoly0_e_l(2,1) = 0.; ppoly0_e_l(2,2) = 0.</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;  ppoly0_e_r(1,1) = 1.; ppoly0_e_r(1,2) = 1.</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  ppoly0_e_r(2,1) = 1.; ppoly0_e_r(2,2) = 1.</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  khtr_u = 1.</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;  <span class="keyword">call </span>fluxes_bulk_method(surface, nk, deg, h_l, h_r, hbl_l, hbl_r, area_l, area_r, phi_l, phi_r, phi_pp_l, phi_pp_r, &amp;</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;                                    ppoly0_e_l, ppoly0_e_r, method, khtr_u, f_bulk, f_layer)</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;  near_boundary_unit_tests = test_layer_fluxes( verbose, nk, test_name, f_layer, (/-5.0,-5.0/) )</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160; </div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;  test_name = <span class="stringliteral">&#39;Equal hbl and same layer thicknesses (gradient from left to right)&#39;</span></div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;  hbl_l = 10.; hbl_r = 10.</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;  h_l = (/5.,5./) ; h_r = (/5.,5./)</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;  phi_l = (/1.,1./) ; phi_r = (/0.,0./)</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;  phi_pp_l(1,1) = 1.; phi_pp_l(1,2) = 0.</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;  phi_pp_l(2,1) = 1.; phi_pp_l(2,2) = 0.</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;  phi_pp_r(1,1) = 0.; phi_pp_r(1,2) = 0.</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;  phi_pp_r(2,1) = 0.; phi_pp_r(2,2) = 0.</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;  ppoly0_e_l(1,1) = 1.; ppoly0_e_l(1,2) = 1.</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;  ppoly0_e_l(2,1) = 1.; ppoly0_e_l(2,2) = 1.</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;  ppoly0_e_r(1,1) = 0.; ppoly0_e_r(1,2) = 0.</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;  ppoly0_e_r(2,1) = 0.; ppoly0_e_r(2,2) = 0.</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;  khtr_u = 1.</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;  <span class="keyword">call </span>fluxes_bulk_method(surface, nk, deg, h_l, h_r, hbl_l, hbl_r, area_l, area_r, phi_l, phi_r, phi_pp_l, phi_pp_r,&amp;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;                                    ppoly0_e_l, ppoly0_e_r, method, khtr_u, f_bulk, f_layer)</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;  near_boundary_unit_tests = test_layer_fluxes( verbose, nk, test_name, f_layer, (/5.0,5.0/) )</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160; </div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;  test_name = <span class="stringliteral">&#39;Equal hbl and same layer thicknesses (no gradient)&#39;</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;  hbl_l = 10; hbl_r = 10</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;  h_l = (/5.,5./) ; h_r = (/5.,5./)</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;  phi_l = (/1.,1./) ; phi_r = (/1.,1./)</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;  phi_pp_l(1,1) = 1.; phi_pp_l(1,2) = 0.</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;  phi_pp_l(2,1) = 1.; phi_pp_l(2,2) = 0.</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;  phi_pp_r(1,1) = 1.; phi_pp_r(1,2) = 0.</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;  phi_pp_r(2,1) = 1.; phi_pp_r(2,2) = 0.</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;  ppoly0_e_l(1,1) = 1.; ppoly0_e_l(1,2) = 0.</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;  ppoly0_e_l(2,1) = 1.; ppoly0_e_l(2,2) = 0.</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;  ppoly0_e_r(1,1) = 1.; ppoly0_e_r(1,2) = 1.</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;  ppoly0_e_r(2,1) = 1.; ppoly0_e_r(2,2) = 1.</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;  khtr_u = 1.</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;  <span class="keyword">call </span>fluxes_bulk_method(surface, nk, deg, h_l, h_r, hbl_l, hbl_r, area_l, area_r, phi_l, phi_r, phi_pp_l, phi_pp_r,&amp;</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;                                    ppoly0_e_l, ppoly0_e_r, method, khtr_u, f_bulk, f_layer)</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;  near_boundary_unit_tests = test_layer_fluxes( verbose, nk, test_name, f_layer, (/0.0,0.0/) )</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160; </div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;  test_name = <span class="stringliteral">&#39;Equal hbl and different layer thicknesses (gradient right to left)&#39;</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  hbl_l = 16.; hbl_r = 16.</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;  h_l = (/10.,6./) ; h_r = (/6.,10./)</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;  phi_l = (/0.,0./) ; phi_r = (/1.,1./)</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;  phi_pp_l(1,1) = 0.; phi_pp_l(1,2) = 0.</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;  phi_pp_l(2,1) = 0.; phi_pp_l(2,2) = 0.</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;  phi_pp_r(1,1) = 1.; phi_pp_r(1,2) = 0.</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;  phi_pp_r(2,1) = 1.; phi_pp_r(2,2) = 0.</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;  ppoly0_e_l(1,1) = 0.; ppoly0_e_l(1,2) = 0.</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;  ppoly0_e_l(2,1) = 0.; ppoly0_e_l(2,2) = 0.</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;  ppoly0_e_r(1,1) = 1.; ppoly0_e_r(1,2) = 1.</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;  ppoly0_e_r(2,1) = 1.; ppoly0_e_r(2,2) = 1.</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;  khtr_u = 1.</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;  <span class="keyword">call </span>fluxes_bulk_method(surface, nk, deg, h_l, h_r, hbl_l, hbl_r, area_l, area_r, phi_l, phi_r, phi_pp_l, phi_pp_r,&amp;</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;                                    ppoly0_e_l, ppoly0_e_r, method, khtr_u, f_bulk, f_layer)</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;  near_boundary_unit_tests = test_layer_fluxes( verbose, nk, test_name, f_layer, (/-8.0,-8.0/) )</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160; </div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;  test_name = <span class="stringliteral">&#39;Equal hbl and same layer thicknesses (diagonal tracer values)&#39;</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;  hbl_l = 10.; hbl_r = 10.</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;  h_l = (/5.,5./) ; h_r = (/5.,5./)</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;  phi_l = (/1.,0./) ; phi_r = (/0.,1./)</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;  phi_pp_l(1,1) = 1.; phi_pp_l(1,2) = 0.</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;  phi_pp_l(2,1) = 0.; phi_pp_l(2,2) = 0.</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;  phi_pp_r(1,1) = 0.; phi_pp_r(1,2) = 0.</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;  phi_pp_r(2,1) = 1.; phi_pp_r(2,2) = 0.</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;  ppoly0_e_l(1,1) = 1.; ppoly0_e_l(1,2) = 1.</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;  ppoly0_e_l(2,1) = 0.; ppoly0_e_l(2,2) = 0.</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;  ppoly0_e_r(1,1) = 0.; ppoly0_e_r(1,2) = 0.</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;  ppoly0_e_r(2,1) = 1.; ppoly0_e_r(2,2) = 1.</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;  khtr_u = 1.</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;  <span class="keyword">call </span>fluxes_bulk_method(surface, nk, deg, h_l, h_r, hbl_l, hbl_r, area_l, area_r, phi_l, phi_r, phi_pp_l, phi_pp_r,&amp;</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;                                    ppoly0_e_l, ppoly0_e_r, method, khtr_u, f_bulk, f_layer)</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;  near_boundary_unit_tests = test_layer_fluxes( verbose, nk, test_name, f_layer, (/0.0,0.0/) )</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160; </div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;  test_name = <span class="stringliteral">&#39;Different hbl and different layer thicknesses (gradient from right to left)&#39;</span></div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;  hbl_l = 12; hbl_r = 20</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;  h_l = (/6.,6./) ; h_r = (/10.,10./)</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;  phi_l = (/0.,0./) ; phi_r = (/1.,1./)</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;  phi_pp_l(1,1) = 0.; phi_pp_l(1,2) = 0.</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  phi_pp_l(2,1) = 0.; phi_pp_l(2,2) = 0.</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;  phi_pp_r(1,1) = 1.; phi_pp_r(1,2) = 0.</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;  phi_pp_r(2,1) = 1.; phi_pp_r(2,2) = 0.</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;  ppoly0_e_l(1,1) = 0.; ppoly0_e_l(1,2) = 0.</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;  ppoly0_e_l(2,1) = 0.; ppoly0_e_l(2,2) = 0.</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;  ppoly0_e_r(1,1) = 1.; ppoly0_e_r(1,2) = 1.</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;  ppoly0_e_r(2,1) = 1.; ppoly0_e_r(2,2) = 1.</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;  khtr_u = 1.</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;  <span class="keyword">call </span>fluxes_bulk_method(surface, nk, deg, h_l, h_r, hbl_l, hbl_r, area_l, area_r, phi_l, phi_r, phi_pp_l, phi_pp_r,&amp;</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;                                    ppoly0_e_l, ppoly0_e_r, method, khtr_u, f_bulk, f_layer)</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;  near_boundary_unit_tests = test_layer_fluxes( verbose, nk, test_name, f_layer, (/-7.5,-7.5/) )</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160; </div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;  <span class="comment">! Cases where hbl &lt; column thickness (polynomial coefficients specified for pseudo-linear reconstruction)</span></div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160; </div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;  test_name = <span class="stringliteral">&#39;hbl &lt; column thickness, hbl same, constant concentration each column&#39;</span></div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;  hbl_l = 2; hbl_r = 2</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;  h_l = (/1.,2./) ; h_r = (/1.,2./)</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;  phi_l = (/0.,0./) ; phi_r = (/1.,1./)</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;  phi_pp_l(1,1) = 0.; phi_pp_l(1,2) = 0.</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;  phi_pp_l(2,1) = 0.; phi_pp_l(2,2) = 0.</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;  phi_pp_r(1,1) = 1.; phi_pp_r(1,2) = 0.</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;  phi_pp_r(2,1) = 1.; phi_pp_r(2,2) = 0.</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;  khtr_u = 1.</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;  <span class="keyword">call </span>fluxes_bulk_method(surface, nk, deg, h_l, h_r, hbl_l, hbl_r, area_l, area_r, phi_l, phi_r, phi_pp_l, phi_pp_r,&amp;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;                                    ppoly0_e_l, ppoly0_e_r, method, khtr_u, f_bulk, f_layer)</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;  near_boundary_unit_tests = test_layer_fluxes( verbose, nk, test_name, f_layer, (/-1.,-1./) )</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160; </div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;  test_name = <span class="stringliteral">&#39;hbl &lt; column thickness, hbl same, linear profile right&#39;</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;  hbl_l = 2; hbl_r = 2</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;  h_l = (/1.,2./) ; h_r = (/1.,2./)</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;  phi_l = (/0.,0./) ; phi_r = (/0.5,2./)</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;  phi_pp_l(1,1) = 0.; phi_pp_l(1,2) = 0.</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;  phi_pp_l(2,1) = 0.; phi_pp_l(2,2) = 0.</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;  phi_pp_r(1,1) = 0.; phi_pp_r(1,2) = 1.</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;  phi_pp_r(2,1) = 1.; phi_pp_r(2,2) = 2.</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;  khtr_u = 1.</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;  ppoly0_e_l(1,1) = 0.; ppoly0_e_l(1,2) = 0.</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;  ppoly0_e_l(2,1) = 0.; ppoly0_e_l(2,2) = 0.</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;  ppoly0_e_r(1,1) = 0.; ppoly0_e_r(1,2) = 1.</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;  ppoly0_e_r(2,1) = 1.; ppoly0_e_r(2,2) = 3.</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;  <span class="keyword">call </span>fluxes_bulk_method(surface, nk, deg, h_l, h_r, hbl_l, hbl_r, area_l, area_r, phi_l, phi_r, phi_pp_l, phi_pp_r,&amp;</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;                                    ppoly0_e_l, ppoly0_e_r, method, khtr_u, f_bulk, f_layer)</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;  near_boundary_unit_tests = test_layer_fluxes( verbose, nk, test_name, f_layer, (/-1.,-1./) )</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160; </div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;  test_name = <span class="stringliteral">&#39;hbl &lt; column thickness, hbl same, linear profile right, khtr=2&#39;</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;  hbl_l = 2; hbl_r = 2</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;  h_l = (/1.,2./) ; h_r = (/1.,2./)</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;  phi_l = (/0.,0./) ; phi_r = (/0.5,2./)</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;  phi_pp_l(1,1) = 0.; phi_pp_l(1,2) = 0.</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;  phi_pp_l(2,1) = 0.; phi_pp_l(2,2) = 0.</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;  phi_pp_r(1,1) = 0.; phi_pp_r(1,2) = 1.</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;  phi_pp_r(2,1) = 1.; phi_pp_r(2,2) = 2.</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;  khtr_u = 2.</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;  ppoly0_e_l(1,1) = 0.; ppoly0_e_l(1,2) = 0.</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;  ppoly0_e_l(2,1) = 0.; ppoly0_e_l(2,2) = 0.</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;  ppoly0_e_r(1,1) = 0.; ppoly0_e_r(1,2) = 1.</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;  ppoly0_e_r(2,1) = 1.; ppoly0_e_r(2,2) = 3.</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;  <span class="keyword">call </span>fluxes_layer_method(surface, nk, deg, h_l, h_r, hbl_l, hbl_r, area_l, area_r, phi_l, phi_r, phi_pp_l, &amp;</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;                                    phi_pp_r, ppoly0_e_l, ppoly0_e_r, method, khtr_u, f_layer)</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;  near_boundary_unit_tests = test_layer_fluxes( verbose, nk, test_name, f_layer, (/-2.,-2./) )</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160; </div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;  <span class="comment">! unit tests for layer by layer method</span></div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;  test_name = <span class="stringliteral">&#39;Different hbl and different column thicknesses (gradient from right to left)&#39;</span></div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;  hbl_l = 12; hbl_r = 20</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;  h_l = (/6.,6./) ; h_r = (/10.,10./)</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  phi_l = (/0.,0./) ; phi_r = (/1.,1./)</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;  phi_pp_l(1,1) = 0.; phi_pp_l(1,2) = 0.</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;  phi_pp_l(2,1) = 0.; phi_pp_l(2,2) = 0.</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;  phi_pp_r(1,1) = 1.; phi_pp_r(1,2) = 0.</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;  phi_pp_r(2,1) = 1.; phi_pp_r(2,2) = 0.</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;  ppoly0_e_l(1,1) = 0.; ppoly0_e_l(1,2) = 0.</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;  ppoly0_e_l(2,1) = 0.; ppoly0_e_l(2,2) = 0.</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;  ppoly0_e_r(1,1) = 1.; ppoly0_e_r(1,2) = 1.</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;  ppoly0_e_r(2,1) = 1.; ppoly0_e_r(2,2) = 1.</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;  khtr_u = 1.</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;  <span class="keyword">call </span>fluxes_layer_method(surface, nk, deg, h_l, h_r, hbl_l, hbl_r, area_l, area_r, phi_l, phi_r, phi_pp_l, &amp;</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;                                    phi_pp_r, ppoly0_e_l, ppoly0_e_r, method, khtr_u, f_layer)</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;  near_boundary_unit_tests = test_layer_fluxes( verbose, nk, test_name, f_layer, (/-7.5,0.0/) )</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160; </div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;  test_name = <span class="stringliteral">&#39;Different hbl and different column thicknesses (linear profile right)&#39;</span></div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160; </div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;  hbl_l = 15; hbl_r = 6</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;  h_l = (/10.,10./) ; h_r = (/12.,10./)</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;  phi_l = (/0.,0./) ; phi_r = (/1.,3./)</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  phi_pp_l(1,1) = 0.; phi_pp_l(1,2) = 0.</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;  phi_pp_l(2,1) = 0.; phi_pp_l(2,2) = 0.</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;  phi_pp_r(1,1) = 0.; phi_pp_r(1,2) = 2.</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;  phi_pp_r(2,1) = 2.; phi_pp_r(2,2) = 2.</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;  ppoly0_e_l(1,1) = 0.; ppoly0_e_l(1,2) = 0.</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;  ppoly0_e_l(2,1) = 0.; ppoly0_e_l(2,2) = 0.</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;  ppoly0_e_r(1,1) = 0.; ppoly0_e_r(1,2) = 2.</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;  ppoly0_e_r(2,1) = 2.; ppoly0_e_r(2,2) = 4.</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;  khtr_u = 1.</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;  <span class="keyword">call </span>fluxes_layer_method(surface, nk, deg, h_l, h_r, hbl_l, hbl_r, area_l, area_r, phi_l, phi_r, phi_pp_l, &amp;</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;                                    phi_pp_r, ppoly0_e_l, ppoly0_e_r, method, khtr_u, f_layer)</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;  near_boundary_unit_tests = test_layer_fluxes( verbose, nk, test_name, f_layer, (/-3.75,0.0/) )</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00034">bottom</a>, <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00356">boundary_k_range()</a>, <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00537">fluxes_bulk_method()</a>, <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00424">fluxes_layer_method()</a>, <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00033">surface</a>, <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l01009">test_boundary_k_range()</a>, and <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00983">test_layer_fluxes()</a>.</p>

<p class="reference">Referenced by <a class="el" href="MOM__unit__tests_8F90_source.html#l00023">mom_unit_tests::unit_tests()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__lateral__boundary__diffusion_a5590830aab282e34bcd5d4df052d4578_cgraph.svg" width="100%" height="579"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__lateral__boundary__diffusion_a5590830aab282e34bcd5d4df052d4578_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="ac7d1d46aeb36ab434b1a6533b47246ce"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac7d1d46aeb36ab434b1a6533b47246ce">&#9670;&nbsp;</a></span>test_boundary_k_range()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">logical function mom_lateral_boundary_diffusion::test_boundary_k_range </td>
          <td>(</td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>k_top</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real&#160;</td>
          <td class="paramname"><em>zeta_top</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>k_bot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real&#160;</td>
          <td class="paramname"><em>zeta_bot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>k_top_ans</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real&#160;</td>
          <td class="paramname"><em>zeta_top_ans</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>k_bot_ans</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real&#160;</td>
          <td class="paramname"><em>zeta_bot_ans</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=80)&#160;</td>
          <td class="paramname"><em>test_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">logical&#160;</td>
          <td class="paramname"><em>verbose</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return true if output of unit tests for boundary_k_range does not match answers. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">k_top</td><td>Index of cell containing top of boundary </td></tr>
    <tr><td class="paramname">zeta_top</td><td>Nondimension position </td></tr>
    <tr><td class="paramname">k_bot</td><td>Index of cell containing bottom of boundary </td></tr>
    <tr><td class="paramname">zeta_bot</td><td>Nondimension position </td></tr>
    <tr><td class="paramname">k_top_ans</td><td>Index of cell containing top of boundary </td></tr>
    <tr><td class="paramname">zeta_top_ans</td><td>Nondimension position </td></tr>
    <tr><td class="paramname">k_bot_ans</td><td>Index of cell containing bottom of boundary </td></tr>
    <tr><td class="paramname">zeta_bot_ans</td><td>Nondimension position </td></tr>
    <tr><td class="paramname">test_name</td><td>Name of the unit test </td></tr>
    <tr><td class="paramname">verbose</td><td>If true always print output </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l01009">1009</a> of file <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html">MOM_lateral_boundary_diffusion.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;  <span class="keywordtype">integer</span> :: k_top<span class="comment">               !&lt; Index of cell containing top of boundary</span></div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;<span class="keywordtype">  real</span>    :: zeta_top<span class="comment">            !&lt; Nondimension position</span></div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;  <span class="keywordtype">integer</span> :: k_bot<span class="comment">               !&lt; Index of cell containing bottom of boundary</span></div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;<span class="keywordtype">  real</span>    :: zeta_bot<span class="comment">            !&lt; Nondimension position</span></div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;  <span class="keywordtype">integer</span> :: k_top_ans<span class="comment">           !&lt; Index of cell containing top of boundary</span></div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;<span class="keywordtype">  real</span>    :: zeta_top_ans<span class="comment">        !&lt; Nondimension position</span></div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;  <span class="keywordtype">integer</span> :: k_bot_ans<span class="comment">           !&lt; Index of cell containing bottom of boundary</span></div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;<span class="keywordtype">  real</span>    :: zeta_bot_ans<span class="comment">        !&lt; Nondimension position</span></div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;  <span class="keywordtype">character(len=80)</span> :: test_name<span class="comment"> !&lt; Name of the unit test</span></div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;  <span class="keywordtype">logical</span> :: verbose<span class="comment">             !&lt; If true always print output</span></div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160; </div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: stdunit = 6</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160; </div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;  test_boundary_k_range = k_top .ne. k_top_ans</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;  test_boundary_k_range = test_boundary_k_range .or. (zeta_top .ne. zeta_top_ans)</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;  test_boundary_k_range = test_boundary_k_range .or. (k_bot .ne. k_bot_ans)</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;  test_boundary_k_range = test_boundary_k_range .or. (zeta_bot .ne. zeta_bot_ans)</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160; </div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;  <span class="keywordflow">if</span> (test_boundary_k_range) <span class="keyword">write</span>(stdunit,*) <span class="stringliteral">&quot;UNIT TEST FAILED: &quot;</span>, test_name</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;  <span class="keywordflow">if</span> (test_boundary_k_range .or. verbose) <span class="keywordflow">then</span></div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    <span class="keyword">write</span>(stdunit,20) <span class="stringliteral">&quot;k_top&quot;</span>, k_top, <span class="stringliteral">&quot;k_top_ans&quot;</span>, k_top_ans</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    <span class="keyword">write</span>(stdunit,20) <span class="stringliteral">&quot;k_bot&quot;</span>, k_bot, <span class="stringliteral">&quot;k_bot_ans&quot;</span>, k_bot_ans</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    <span class="keyword">write</span>(stdunit,30) <span class="stringliteral">&quot;zeta_top&quot;</span>, zeta_top, <span class="stringliteral">&quot;zeta_top_ans&quot;</span>, zeta_top_ans</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    <span class="keyword">write</span>(stdunit,30) <span class="stringliteral">&quot;zeta_bot&quot;</span>, zeta_bot, <span class="stringliteral">&quot;zeta_bot_ans&quot;</span>, zeta_bot_ans</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;<span class="keywordflow">  endif</span></div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160; </div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;  20 <span class="keyword">format</span>(a,<span class="stringliteral">&quot;=&quot;</span>,i3,x,a,<span class="stringliteral">&quot;=&quot;</span>,i3)</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;  30 <span class="keyword">format</span>(a,<span class="stringliteral">&quot;=&quot;</span>,f20.16,x,a,<span class="stringliteral">&quot;=&quot;</span>,f20.16)</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160; </div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00714">near_boundary_unit_tests()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__lateral__boundary__diffusion_ac7d1d46aeb36ab434b1a6533b47246ce_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<a id="a9c689c24bc59f46aa960b33119fe7e59"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9c689c24bc59f46aa960b33119fe7e59">&#9670;&nbsp;</a></span>test_layer_fluxes()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">logical function mom_lateral_boundary_diffusion::test_layer_fluxes </td>
          <td>(</td>
          <td class="paramtype">logical, intent(in)&#160;</td>
          <td class="paramname"><em>verbose</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=80), intent(in)&#160;</td>
          <td class="paramname"><em>test_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk), intent(in)&#160;</td>
          <td class="paramname"><em>F_calc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(nk), intent(in)&#160;</td>
          <td class="paramname"><em>F_ans</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns true if output of near-boundary unit tests does not match correct computed values and conditionally writes results to stream. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">verbose</td><td>If true, write results to stdout </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">test_name</td><td>Brief description of the unit test </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nk</td><td>Number of layers </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">f_calc</td><td>Fluxes of the unitless tracer from the algorithm [s^-1] </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">f_ans</td><td>Fluxes of the unitless tracer calculated by hand [s^-1] </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00983">983</a> of file <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html">MOM_lateral_boundary_diffusion.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;  <span class="keywordtype">logical</span>,                    <span class="keywordtype">intent(in)</span> :: verbose<span class="comment">   !&lt; If true, write results to stdout</span></div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;  <span class="keywordtype">character(len=80)</span>,          <span class="keywordtype">intent(in)</span> :: test_name<span class="comment"> !&lt; Brief description of the unit test</span></div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;  <span class="keywordtype">integer</span>,                    <span class="keywordtype">intent(in)</span> :: nk<span class="comment">        !&lt; Number of layers</span></div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(nk)</span>,        <span class="keywordtype">intent(in)</span> :: F_calc<span class="comment">    !&lt; Fluxes of the unitless tracer from the algorithm [s^-1]</span></div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;<span class="keywordtype">  real</span>, <span class="keywordtype">dimension(nk)</span>,        <span class="keywordtype">intent(in)</span> :: F_ans<span class="comment">     !&lt; Fluxes of the unitless tracer calculated by hand [s^-1]</span></div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;  <span class="comment">! Local variables</span></div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;  <span class="keywordtype">integer</span> :: k</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;  <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: stdunit = 6</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160; </div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;  test_layer_fluxes = .false.</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;  <span class="keywordflow">do</span> k=1,nk</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;    <span class="keywordflow">if</span> ( f_calc(k) /= f_ans(k) ) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;      test_layer_fluxes = .true.</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;      <span class="keyword">write</span>(stdunit,*) <span class="stringliteral">&quot;UNIT TEST FAILED: &quot;</span>, test_name</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;      <span class="keyword">write</span>(stdunit,10) k, f_calc(k), f_ans(k)</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    <span class="keywordflow">elseif</span> (verbose) <span class="keywordflow">then</span></div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;      <span class="keyword">write</span>(stdunit,10) k, f_calc(k), f_ans(k)</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;<span class="keywordflow">    endif</span></div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;<span class="keywordflow">  enddo</span></div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160; </div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;10 <span class="keyword">format</span>(<span class="stringliteral">&quot;Layer=&quot;</span>,i3,<span class="stringliteral">&quot; F_calc=&quot;</span>,f20.16,<span class="stringliteral">&quot; F_ans&quot;</span>,f20.16)</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00714">near_boundary_unit_tests()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="namespacemom__lateral__boundary__diffusion_a9c689c24bc59f46aa960b33119fe7e59_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a2d5308bf15dc0816cdbef33287152b4a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2d5308bf15dc0816cdbef33287152b4a">&#9670;&nbsp;</a></span>bottom</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer, parameter, public mom_lateral_boundary_diffusion::bottom = 1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set a value that corresponds to the bottom boundary. </p>

<p class="definition">Definition at line <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00034">34</a> of file <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html">MOM_lateral_boundary_diffusion.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="keywordtype">integer</span>, <span class="keywordtype">public</span>, <span class="keywordtype">parameter</span> :: BOTTOM  = 1<span class="comment">  !&lt; Set a value that corresponds to the bottom boundary</span></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00356">boundary_k_range()</a>, <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00293">bulk_average()</a>, <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00537">fluxes_bulk_method()</a>, <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00424">fluxes_layer_method()</a>, and <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00714">near_boundary_unit_tests()</a>.</p>

</div>
</div>
<a id="a61c6b3e00d03dafc0c7625788a787b10"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a61c6b3e00d03dafc0c7625788a787b10">&#9670;&nbsp;</a></span>mdl</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="version__variable_8h.html#acda997fe1761de4c6bca0f27dc786964">character</a>(len=40) mom_lateral_boundary_diffusion::mdl = &quot;MOM_lateral_boundary_diffusion&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Name of this module. </p>

<p class="definition">Definition at line <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00055">55</a> of file <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html">MOM_lateral_boundary_diffusion.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">character(len=40) :: mdl = &quot;MOM_lateral_boundary_diffusion&quot;       !&lt; Name of this module</span></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00062">lateral_boundary_diffusion_init()</a>.</p>

</div>
</div>
<a id="ace1430e08cc68a474c478e53f955c715"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ace1430e08cc68a474c478e53f955c715">&#9670;&nbsp;</a></span>surface</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">integer, parameter, public mom_lateral_boundary_diffusion::surface = -1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set a value that corresponds to the surface bopundary. </p>

<p class="definition">Definition at line <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00033">33</a> of file <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html">MOM_lateral_boundary_diffusion.F90</a>.</p>
<div class="fragment"><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="keywordtype">integer</span>, <span class="keywordtype">public</span>, <span class="keywordtype">parameter</span> :: SURFACE = -1<span class="comment"> !&lt; Set a value that corresponds to the surface bopundary</span></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00356">boundary_k_range()</a>, <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00293">bulk_average()</a>, <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00537">fluxes_bulk_method()</a>, <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00424">fluxes_layer_method()</a>, <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00123">lateral_boundary_diffusion()</a>, <a class="el" href="MOM__lateral__boundary__diffusion_8F90_source.html#l00714">near_boundary_unit_tests()</a>, and <a class="el" href="MOM__neutral__diffusion_8F90_source.html#l00264">mom_neutral_diffusion::neutral_diffusion_calc_coeffs()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacemom__lateral__boundary__diffusion.html">mom_lateral_boundary_diffusion</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.16 </li>
  </ul>
</div>
</body>
</html>
